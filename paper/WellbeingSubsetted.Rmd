---
title: "WellbeingSubsetted"
author: "Jerimiah Williams"
date: "April 5, 2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(dplyr)
library(readr)
library(naniar)
library(glmnet)
library(ggplot2)
library(MASS)
library(Hmisc)
library(reshape2)
library(cluster)
library(gdata)
library(car)
library(knitr)
library(kableExtra)
library(pdp)
library(corrplot)
library(pastecs)
library(rms)
library(magick)
library(webshot)
library(tidyr)
library(ggthemes)
```

```{r}
#load(file = "new.RData")
```


```{r}
df_subsetall2 <- df_geda_LifeExp %>% dplyr::select(c(
ABschichtC, #Shift and night work
ABsubjB, #Health risk from work
ABtragen, #Lifting and / or carrying heavy loads
age5B, #Age (5-year groups)
AKbingeC_k, #Binge drinking (> = 6 alk. Drinks. On one occasion) in 4 Cat.
AKechi47, #Hazardous alcohol consumption (ECHI 47;> 20/40 g / day)
AKoft12_k, #Alcohol i.d.l. 12 months in 6 Cat.
AKrisiko, #Hazardous alcohol consumption (> 20.10 g / day)
AKrisiko2, #Hazardous alcohol consumption (> 20.10 g / day) 4 Kat.
AMarztB, #Taking medications v. Doctor prescribed i.d.l. 2 Where
AMfrei, #v not taking medication. Doctor prescribed i.d.l. 2 Where
AUarbC, #not due to illness to work: I.d.l. 12 Mon.
AUarbzD_k, #not due to illness to work: weeks
BBbehB, #Officially recognized disability
BBbehzC_k, #kat degree of disability.
BBblas12B, #Urinary incontinence: I.d.l.12 Mon.
BBdors112, #Lower back pain: I.d.l.12 Mon.
BBdors212, #Complaints neck, cervical spine: I.d.l.12 Mon.
BBgehen, #Schwierigk. when walking without walking aids at 500m
BBmyo12, #Chronic pain after heart attack: I.d.l.12 Mon.
BBsa12, #Chronic plaints. following a stroke: I.d.l.12 Mon.
BBtreppe, #Schwierigk. Staircase with 12 steps
BLpflege2C, #Support / care of others
BLpflegedauB, #Support / Care: Hours per week
bula, #state
ENgemB, #Consumption of vegetables
ENgemBz1, #Consumption of vegetables: per day
ENobstB, #Consumption of fruit
ENobstBz1, #Consumption of fruits: per day
GVasku1, #Reliance on prop. Diffic skills. situations
GZmehm1, #Gen. health status
GZmehm2D, #Limited by disease for min. 6 months
GZmehm3C, #Chronic diseases
GZsubj1, #Pay attention to health
IAambC, #Day patient in the hospital i.d.l. 12 Mon.
IAambC_k, #Day patient in the hospital i.d.l. 12 month .: number of shots (top coding 10 or more)
IAarzt14B, #Dental examination
IAarzt1B, #Visit general practitioners or family doctor
IAarzt1B12_k, #Visit general practitioners or family doctor i.d.l. 12 month .: Number (top coding 20 or more)
IAarzt1B4w, #Visit general practitioners or family doctor i.d.l. 4 weeks: Number
IAarzt8C, #Visit psychologists i.d.l. 12 Mon.
IAcholus, #Last blood fat determination
IAdiabus, #Last blood glucose monitoring
IAfa, #Visiting Specialist
IAfa12_k, #Visiting Specialist i.d.l. 12 month .: Number (top coding 20 or more)
IAfa4w, #Visiting Specialist i.d.l. 4 weeks: Number
IAhypus, #Last blood pressure measurement
IAkfutyp2B_lz, #Last stool test
IAkfutyp4B_lz, #Last colonoscopy
IAkfutyp5B_lz, #Last cervical smear
IAkfutyp7B_lz, #Last mammography
IAkfutyp7Bgr, #Reason for the last mammogram
IAkhs, #Stationary i.d.l. in hospital 12 Mon.
IAkhs_k, #Stationary i.d.l. in hospital 12 month .: Number of nights (cat)
IAkosten1, #US Required / n treatment. Affordable i.d.l. 12 month .: Physicians. US / treatment
IAkosten2, #US Required / n treatment. Affordable i.d.l. 12 month .: Zahnärztl. US / treatment
IAkosten3, #US Required / n treatment. Affordable i.d.l. 12 month .: Prescribed Med.
IAkosten4, #US Required / n treatment. Affordable i.d.l. 12 month .: US / psy treatment. Prob.
IAkv1D, #Health Insurance in 3 Cat.
IApflege, #Use of home care services: I.d.l. 12 Mon.
IAtermin, #i.d.l. waiting for examination appointment 12 Mon.
IAther2B, #Visit physiotherapists i.d.l. 12 Mon
IAweg, #Investigation delayed due i.d.l. Distance 12 Mon.
IPinfl1314B, #Flu vaccination winter season 2013/2014 generated
IPinfl1415B, #Flu vaccination winter season 2014/2015 generated
IPinfl4, #Last flu shot
IPinfl4_jj, #Last flu shot: Year
IPinfl4_mm, #Last flu shot: Month
IPinfl6B, #Frequency flu vaccine generated
IPtet, #Ever tetanus vaccination
IPtet_lz, #Last tetanus shot
KAabka, #Moderate to very strenuous arbeitsbez. körp. activity
KAehispaq1, #Activities (effort)
KAehispaq2, #Movement on foot: days a week
KAehispaq3, #Movement on foot: Duration
KAehispaq4, #Movement with bicycle: days a week
KAehispaq5, #Movement with bicycle: Duration
KAehispaq6, #Sports: days a week
KAehispaq8, #Building / strengthening: days a week
KAgfa, #> = 150 min Ausdaueraktiv.und 2x / week Active. for Muskelkräft. (stop. WHO both Sens.)
KAgfka, #Stop. aerobic WHO Bew.empf. (With Go> = 150 min. Aerobic körp. Aktiv./Wo)
KAgfka1, #Stop. aerobic WHO Bew.empf. (O. Go> = 150 aerobic körp. Aktiv./Wo min.)
KAgfmk, #WHO Rec. to Muskelkräft. (> = 2x / wk. Activities. To strengthen the muscles)
KAgka, #Sufficient körp. active during work or leisure
KAgka_k, #total activity
KAsabka, #Very strenuous work-related physical activity
KAspodauC_k, #Sports week in total (category Siert in 30 min)
KAtbka_k, #Transportbez. körp. Activity in MET / hours / week (top coding from 100h)
KHab12, #Asthma: I.d.l.12 Mon.
KHalgi112, #Allergies: I.d.l. 12 Mon.
KHbbmyo12, #Heart attack / chron. Plaints .: I.d.l. 12 Mon.
KHbbsa12, #Stroke / chron. Complaints resulting SA: I.d.l.12 Mon.
KHcb12, #Chronic bronchitis: I.d.l.12 Mon.
KHced12, #Inflammatory bowel disease: I.d.l.12 Mon.
KHcle12, #Other chronic liver diseases: I.d.l.12 Mon.
KHdge12, #Osteoarthritis: I.d.l.12 Mon.
KHdiabB12, #Diabetes: I.d.l.12 Mon.
KHhi12, #Heart failure: I.d.l.12 Mon.
KHhyp, #Hypertension: Ever diagnosed medically
KHhyp12, #Hypertension: I.d.l.12 Mon.
KHhyp12pB, #Indicator bek. (Ärztl. Diagn.) Hypertension pressure i.d.l. 12 Mon
KHhypmedC, #Indicator antihypertensive agents with known hypertension
KHkarz12, #Cancer: I.d.l.12 Mon.
KHkhk12, #Coronary heart disease / angina pectoris: I.d.l.12 Mon.
KHlip12A, #Elevated blood lipids / Chol .: I.d.l.12 Mon.
KHlipA, #Ever elevated blood lipids / Cholesterinw. (Physician diagnosis)
KHlipmedA, #Elevated cholesterol: Currently taking medication
KHlz12, #Cirrhosis: I.d.l.12 Mon.
KHmyo12, #Heart Attack: I.d.l. 12 Mon.
KHniB12, #. Chronic kidney problems: I.d.l.12 Mon.
KHos12, #Osteoporosis: I.d.l.12 Mon.
KHra12, #Arthritis: I.d.l.12 Mon.
KHsa12, #Stroke: I.d.l.12 Mon.
KHulc12, #Gastric or duodenal ulcer: I.d.l.12 Mon.
LQsf367C, #Strength pain i.d.l. 4 weeks
LQsf368C, #Disability in daily activities due to pain i.d.l. 4 weeks
LQzufrB10, #overall life satisfaction
MIbirthplace, #Country of birth (EHIS)
MIcitizen, #nationality
PAadiposB, #Obesity according to WHO (BMI> = 30; from self-declaration)
PAbmiB_k, #BMI moiety (from self-specification)
PAbmiB_k2, #BMI grouping detaill. (From self-specification)
PAfam3, #Living together in marriage or cohabitation
PAgewiB, #Body weight (self-specification) [kg]
PAgroe, #Height (self-specification) [cm]
PAhh_k, #Number of people in household (cat.)
PAhhtype, #household type
PAueberB, #Obesity according to WHO (BMI> = 25; from self-declaration)
PKdep12, #Depression: I.d.l. 12 Mon.
PKphq1, #Adversely. i.d.l. 2 Where .: Little interest / pleasure in your activities
PKphq2, #Adversely. i.d.l. 2 Where .: dejection, melancholy / hopelessness
PKphq3, #Adversely. i.d.l. 2 Where .: Schwierigk., On / od asleep. Increased sleep
PKphq4, #Adversely. i.d.l. 2 Where .: fatigue / feeling, k. to have power
PKphq5, #Adversely. i.d.l. 2 Where .: Vermind. Appetite / excessive need to eat
PKphq6, #Adversely. i.d.l. 2 Where v .: Poor opinion. yourself; to disappointments failure / family.
PKphq7, #Adversely. i.d.l. To focus 2 Where .: Schwierigk.
PKphq8, #Adversely. i.d.l. 2 Where .: change in movement or speech
PKphq8diag, #PHQ-8: Diagnostic Cat.
RC_ak, #Start smoking: age (cat.)
RCex_ak, #End Smoking: age (cat.)
RCpass4, #Smoking in enclosed spaces
RCpassort_m1, #Passive smoking: Work
RCpassort_m2, #Passive Smoking: at home
RCpassort_m3, #Passive smoking: pubs / cafes / bars / disco
RCpassort_m4, #Passive smoking restaurant
RCpassort_m5, #Passive smoking: friends / acquaintances
RCpassort_m6, #Passive smoking: Change village
RCpassort_m7, #Passive smoking: public. building
RCstat, #Smoke
RCtyp_m1, #Tobacco products: Factory-built cigarettes
RCtyp_m2, #Tobacco Products: Hand-rolled cigarettes
RCtyp_m3, #Tobacco products: cigars, cigarillos
RCtyp_m4, #Tobacco products: pipe tobacco
RCtyp_m6, #Tobacco products: Miscellaneous
RCtyp_m7, #Tobacco Products: E-Cigarette
RCtyphaupt, #Mainly smoked Takabprodukt
RCz2B_ttk, #Hand-rolled cigarettes daily: (cat.) Number
RCz2B_wwk, #-Rolled cigarettes weekly: Quantity (kat)
RCzA_ttk, #Daily. Smoking: Tgl. Number of cigarettes (cat.)
RCzA_wwk, #Cigarettes weekly (cat.) No.
SDaeqeink_k, #Equivalent income (imputed, kat) [€]
SDalo, #Unemployed i.d.l. 5 years
SDalo_mmk, #Unemployed: total months i.d.l. 5 years (cat.)
SDalogz, #Change in health by unemployment
SDalokh, #Unemployment to do with disease
SDbest, #Professional status in main job
SDbest_lz, #Professional status in last main job
SDbild1D, #Highest general. Bildener school
SDbild4C, #Highest berufl. Training or university / college degree
SDbverh, #Type of last employment
SDbverh2, #Type of employment
SDerwt0a, #Life situation currently
SDetoed, #Main job in public. service
SDft_pt, #Full or part time employment
SDfuehr, #Recent activity primarily as a management supervisor
SDfuehr2, #Activity primarily as a management supervisor
SDhhincomez, #Monthly. (Imputed) HH net income into quintiles
SDhvtypD, #Breadwinner in the household
SDjobstat, #Professional status
SDmainstat, #Employment (EHIS)
SDses, #Socioeconomic status (SES)
SEschwA_zz, #Pregnant at the time
sex, #gender
SFoslo1C, #Related parties
SFoslo2C, #Participation of other persons
SFoslo3A, #Getting Help
SFosloA, #Social support (Oslo 3 Social Support Scale)
SHhoer1, #hearing Aid
SHhoer5, #Schwierigk. even with hearing aids: Quiet room
SHhoer6, #Schwierigk. even with hearing aids: Loud room
SHseh1, #Glasses or Contacts
SHseh2C, #Difficulties even with glasses or contact lenses
UVarbeit1, #Injury accident at work: I.d.l. 12 months (no way accident)
UVarbeit2, #Injury accident at work: medicine. provided (no way accident)
UVartfreiz, #Wg injury. Accident i.d.l. 12 months: Accident in leisure
UVarthaus, #Wg injury. Accident i.d.l. 12 months: Accident at home
UVartverkehr, #Wg injury. Accident i.d.l. 12 months: Traffic accident
UVarztE_k, #Medical care after an accident three Cat.
PAbmiB_k2,
LifeExp
))
```

```{r}
for (i in colnames(df_subsetall2)){
  
  col_meta <- df_meta_lvls[df_meta_lvls$Varname == i,]
  
  col_type <- col_meta[1,]$Type
  
  if(nrow(col_meta) > 0){
    
    if (col_type == 'Nominal' |col_type == 'Ordinal' ){
      
      unique_lvls <- unique(df_geda_de[[i]])
      
      # for text columns, change data to factors 
      
      df_subsetall2[[i]] <- factor(df_subsetall2[[i]], levels=col_meta$numLevel, labels=col_meta$numLevel)
      
    }else if (col_type == "Scale"){
      
      unique_lvls <- unique(col_meta)
      
      for (row_it in 1:nrow(col_meta)){
        
        l <- col_meta[row_it,]$textLevel
        
        if (!is.na(l) & l != ""){
        
          df_subsetall2[[i]][df_subsetall2[[i]] == l] <- col_meta[col_meta$textLevel == l,]$numLevel
          
        }
        
      }
      
      # for scale columns, change datatype to numeric 
      df_subsetall2[[i]]<- as.numeric(df_subsetall2[[i]])
      
    }
      # add variable label, access this with Hmisc-functions like describe(%dataframe%)
      
      label(df_subsetall2[[i]]) <- col_meta[1,]$VarLabel
      
      
  }else{
    print(paste(i, ": type: ", col_type))
  }
  
}
```

```{r}
df_subsetall2[df_subsetall2$ENobstB == 2 & !is.na(df_subsetall2$ENobstBz1),]$ENobstBz1 = round(5/7,2)
df_subsetall2[df_subsetall2$ENobstB == 3 & !is.na(df_subsetall2$ENobstBz1),]$ENobstBz1 = round(2/7,2)
df_subsetall2[df_subsetall2$ENobstB == 4 & !is.na(df_subsetall2$ENobstBz1),]$ENobstBz1 = round(1/7,2)
df_subsetall2[df_subsetall2$ENobstB == 5 & !is.na(df_subsetall2$ENobstBz1),]$ENobstBz1 = 0

df_subsetall2$ENobstBz1 <- as.numeric(df_subsetall2$ENobstBz1)

# deselect the question 
df_subsetall2<- df_subsetall2 %>% dplyr::select(-ENobstB)
```

```{r}
df_subsetall2[df_subsetall2$ENgemB == 2 & !is.na(df_subsetall2$ENgemBz1),]$ENgemBz1 = round(5/7,2)
df_subsetall2[df_subsetall2$ENgemB == 3 & !is.na(df_subsetall2$ENgemBz1),]$ENgemBz1 = round(2/7,2)
df_subsetall2[df_subsetall2$ENgemB == 4 & !is.na(df_subsetall2$ENgemBz1),]$ENgemBz1 = round(1/7,2)
df_subsetall2[df_subsetall2$ENgemB == 5 & !is.na(df_subsetall2$ENgemBz1),]$ENgemBz1 = 0

df_subsetall2$ENgemBz1 <- as.numeric(df_subsetall2$ENgemBz1)

# deselect the question 
df_subsetall2<- df_subsetall2 %>% dplyr::select(-ENgemB)
```

```{r}
df_subsetall2[(df_subsetall2$SDbild1D == 8 | df_subsetall2$SDbild1D == 1 | df_subsetall2$SDbild1D == 2 | df_subsetall2$SDbild1D == 3) & !is.na(df_subsetall2$SDbild1D),]$SDbild1D <- 2
df_subsetall2[(df_subsetall2$SDbild1D == 3 | df_subsetall2$SDbild1D == 4 | df_subsetall2$SDbild1D == 5) & !is.na(df_subsetall2$SDbild1D) ,]$SDbild1D <- 5
df_subsetall2[(df_subsetall2$SDbild1D == 6 | df_subsetall2$SDbild1D == 7) & !is.na(df_subsetall2$SDbild1D) ,]$SDbild1D <- 7

df_subsetall2$SDbild1D <- drop.levels(df_subsetall2$SDbild1D)
```

```{r}
df_subsetall2[df_subsetall2$KAspodauC_k == '-96' & !is.na(df_subsetall2$KAspodauC_k),]$KAspodauC_k <- 0

df_subsetall2$KAspodauC_k <- as.numeric(df_subsetall2$KAspodauC_k)
```

```{r}
df_subsetall2$AUarbzD_k <- as.numeric(df_overall$AUarbzD_k)
```

```{r}
df_subsetall2[(df_subsetall2$IPtet_lz == '-96' | df_subsetall2$IPtet_lz == '-95' ) & !is.na(df_subsetall2$IPtet_lz),]$IPtet_lz <- NA
```

```{r}
df_subsetall2[df_subsetall2$IAarzt1B4w == '-96' & !is.na(df_subsetall2$IAarzt1B4w),]$IAarzt1B4w <- 0

df_subsetall2$IAarzt1B4w <- as.numeric(df_subsetall2$IAarzt1B4w)
```

```{r}
df_subsetall2[df_subsetall2$IAfa4w == '-96' & !is.na(df_subsetall2$IAfa4w),]$IAfa4w <- 0

df_subsetall2$IAfa4w <- as.numeric(df_subsetall2$IAfa4w)
```

```{r}
df_subsetall2$IAkhs_k <- as.numeric(df_subsetall2$IAkhs_k)
```

```{r}
df_subsetall2$flagHadAccident <-  ifelse( is.na(df_subsetall2$UVartverkehr) & is.na(df_subsetall2$UVarthaus) & is.na(df_subsetall2$UVartfreiz) & is.na(df_subsetall2$UVarbeit1), NA, 
        
        ifelse(df_subsetall2$UVartverkehr == 1 | df_subsetall2$UVarthaus == 1 |df_subsetall2$UVartfreiz == 1 |df_subsetall2$UVarbeit1 == 1 , 
1,0))

df_subsetall2$flagHadAccident <- factor(df_subsetall2$flagHadAccident)
```

```{r}
col_meta <- df_meta_lvls[df_meta_lvls$Varname == 'GZmehm1',]

df_subsetall2$GZmehm1 <- ordered(df_subsetall2$GZmehm1, levels=col_meta[order(col_meta$numLevel),]$numLevel, labels=col_meta[order(col_meta$numLevel),]$numLevel)

describe(df_subsetall2$GZmehm1)
```

```{r}
curr_cols2 <- c(
  
  # step 1: master data
  'sex', #Geschlecht
  "age5B", #Alter (5-Jahres-Gruppen)
  "MIbirthplace", #Geburtsland (EHIS)
  "MIcitizen", #Staatsangehörigkeit
  "bula", #Bundesland
  "PAgroe", #Körpergröße (Selbstangabe) [cm]
  "PAgewiB", #Körpergewicht (Selbstangabe) [kg]
  "IAkv1D", #Krankenversicherung in 3 Kat.
  
  # step 2: socio economic data
  "SDaeqeink_k", #Äquivalenzeinkommen (imputiert,kat) [€]
  "SDbild4C", #Höchster berufl. Ausbildungs- oder Hochschul/Fachhochschulabschluss
  "SDbverh2", #Art des Beschäftigungsverhältnisses
  "SDhvtypD", #Hauptverdiener im Haushalt
  "SDmainstat", # Erwerbstätigkeit
  "SDalo", #Arbeitslos i.d.l. 5 Jahren, 
  "PAhhtype", #Haushaltstyp
  
  # step 3: way of life
  "ENobstBz1",  #Verzehr von Obst: pro Tag
  "ENgemBz1", #Verzehr von Gemüse: pro Tag
  "AKoft12_k", #Alkohol i.d.l. 12 Mon. in 6 Kat.
  "RCstat",  # Smoking
  "KAehispaq2", #Bewegung zu Fuß: Tage pro Woche
  "KAehispaq4", #Bewegung mit Fahrrad: Tage pro Woche
  "KAspodauC_k", #Sport pro Woche insgesamt (in 30 min kategoriesiert)
  "KAehispaq8", #Aufbau/Kräftigung: Tage pro Woche
  "KAgfka", #Einhalt. aerobe WHO-Bew.empf. (mit Gehen >= 150 Min. aerobe körp. Aktiv./Wo)
  "KAgfa", #>= 150 min Ausdaueraktiv.und 2 x/ Woche Aktiv. zur Muskelkräft.(Einhalt. beider WHO-Empf.)
  "KAgfka1", #Einhalt. aerobe WHO-Bew.empf. (o. Gehen >= 150 Min. aerobe körp. Aktiv./Wo)
  "KAgfmk", #WHO-Empf. zur Muskelkräft. (>= 2x/Wo. Aktivit. zur Muskelkräftigung)
  
  # step 4: health care
  "IPinfl4", #Letzte Grippeimpfung
  "IPinfl6B", #Häufigkeit Grippeimpfung, generiert
  "IPtet_lz", #las tetanus vaccination --> flag cannot be used since there are only "YES" tetanus vaccinated people
  "AMarztB", #Einnahme Medikamente v. Arzt verschrieben i.d.l. 2 Wo
  "AMfrei", #Einnahme Medikamente nicht v. Arzt verschrieben i.d.l. 2 Wo
  "AUarbzD_k", #Krankheitsbedingt nicht zur Arbeit: Wochen
  "IAhypus", #Letzte Blutdruckmessung
  "IAcholus", #Letzte Blutfettwertebestimmung
  "IAdiabus", #Letzte Blutzuckermessung
  "IAkfutyp2B_lz", #Letzter Stuhltest
  "IAkfutyp4B_lz", #Letzte Darmspiegelung
  # exclude as of now, since only relevant for women: IAkfutyp7B_lz, #Letzte Mammografie
  # exclude as of now, since only relevant for women: IAkfutyp7Bgr, #Grund für die letzte Mammografie
  # exclude as of now, since only relevant for women: IAkfutyp5B_lz, #Letzter Gebärmutterhalsabstrich
  "IAtermin", #Auf Untersuchungstermin gewartet i.d.l. 12 Mon.
  "IAweg", #Untersuchung verzögert wegen Entfernung i.d.l. 12 Mon.
  # IAkosten1, #Benötigte US/Behandlung n. bezahlbar i.d.l. 12 Mon.: Ärztl. US/Behandlung
  # IAkosten2, #Benötigte US/Behandlung n. bezahlbar i.d.l. 12 Mon.: Zahnärztl. US/Behandlung
  # IAkosten3, #Benötigte US/Behandlung n. bezahlbar i.d.l. 12 Mon.: Verordnete Med.
  # IAkosten4, #Benötigte US/Behandlung n. bezahlbar i.d.l. 12 Mon.: US/Behandlung psy. Prob.
  "IAarzt14B", #Zahnmedizinische Untersuchung
  "IAarzt1B4w", #Besuch Allgemeinarzt oder Hausarzt i.d.l. 4 Wochen: Anzahl
  "IAfa4w", #Besuch Facharzt i.d.l. 4 Wochen: Anzahl
  "IAarzt8C", #Besuch Psychologen i.d.l. 12 Mon.
  "IAkhs", #Stationär im Krankenhaus i.d.l. 12 Mon.
  "IAkhs_k", #Stationär im Krankenhaus i.d.l. 12 Mon.: Anzahl der Nächte (kat) --> encoded in # of weeks
  "IAther2B", #Besuch Physiotherapeuten i.d.l. 12 Mon
  "IApflege", #Inanspruchnahme häuslicher Pflegedienst: I.d.l. 12 Mon.
  
  # step 5: health conditions
  # exclude as of now, since only relevant for women: "SEschwA_zz", #Schwanger zur Zeit
  "GZmehm3C", #Chronische Krankheiten
  "GZmehm2D", #Einschränkung durch Krankheit seit mind. 6 Monaten
  "BBbehB", #Amtlich anerkannte Behinderung 
  "GZsubj1", #Achten auf Gesundheit
  "SHseh1", #Brille oder Kontaktlinsen
  "SHhoer1", #Hörgerät
  "LQsf367C", #Stärke Schmerzen i.d.l. 4 Wochen
  "LQsf368C", #Behinderung in Alltagstätigkeiten durch Schmerzen i.d.l. 4 Wochen
  "flagHadAccident" , # has had any injuries due to accidents in past 12 months
  "BBdors112", #Beschwerden unterer Rücken: I.d.l.12 Mon.
  "BBdors212", #Beschwerden Nacken, Halswirbelsäule: I.d.l.12 Mon.
  "BBblas12B", #Harninkontinenz: I.d.l.12 Mon.
  "BBgehen", #Schwierigk. beim Laufen ohne Gehhilfe auf 500m
  "BBtreppe", #Schwierigk. Treppe mit 12 Stufen
  "BBmyo12", #Chronische Beschwerden nach Herzinfarkt: I.d.l.12 Mon.
  "BBsa12", #Chronische Beschw. infolge eines Schlaganfalls: I.d.l.12 Mon.
  "KHhyp12", #Bluthochdruck: I.d.l.12 Mon.
  "KHhyp", #Bluthochdruck: Jemals ärztlich diagnostiziert
  "KHhyp12pB", #Indikator bek. (ärztl. diagn.) Bluthochdruckdruck i.d.l. 12 Mon
  "KHhypmedC", #Indikator blutdrucksenkende Mittel bei bekannter Hypertonie
  "KHmyo12", #Herzinfarkt: I.d.l. 12 Mon.
  "KHkhk12", #Koronare Herzerkrankung/Angina Pectoris: I.d.l.12 Mon.
  "KHbbmyo12", #Herzinfarkt/chron. Beschw.: I.d.l. 12 Mon.
  "KHhi12", #Herzinsuffizienz: I.d.l.12 Mon.
  "KHsa12", #Schlaganfall: I.d.l.12 Mon.
  "KHdiabB12", #Diabetes: I.d.l.12 Mon.
  "KHab12", #Asthma: I.d.l.12 Mon.
  "KHkarz12", #Krebserkrankung: I.d.l.12 Mon.
  "KHlip12A", #Erhöhte Blutfette/Chol.: I.d.l.12 Mon.
  "KHlipA", #Jemals erhöhte Blutfette/Cholesterinw. (Arztdiagnose)
  "KHlipmedA", #Erhöhtes Cholesterin: Zurzeit Medikamenteneinnahme
  "KHcb12", #Chronische Bronchitis: I.d.l.12 Mon.
  "KHulc12", #Magen- oder Zwölffingerdarmgeschwür: I.d.l.12 Mon.
  "KHced12", #Chronisch entzündliche Darmerkrankung: I.d.l.12 Mon.
  "KHlz12", #Leberzirrhose: I.d.l.12 Mon.
  "KHcle12", #Andere chronische Lebererkrankungen: I.d.l.12 Mon.
  "KHniB12", #Chron. Nierenprobleme: I.d.l.12 Mon.
  "KHdge12", #Arthrose: I.d.l.12 Mon.
  "KHra12", #Arthritis: I.d.l.12 Mon.
  "KHos12", #Osteoporose: I.d.l.12 Mon.
  "KHalgi112", #Allergien: I.d.l. 12 Mon.

  # step 6: psychological health
  "LQzufrB10", #Zufriedenheit: Leben insgesamt
  "PKdep12", #Depression: I.d.l. 12 Mon.
  "SFoslo1C", #Nahestehende Personen
  "SFoslo3A", #Erhalt von Hilfe
  "SFosloA", #Soziale Unterstützung (Oslo-3 Social Support Scale)
  "PAbmiB_k2",
  "LifeExp"
)

curr_cols_all2 <- append(curr_cols2, "GZmehm1")
```

```{r}
#All code above is the same as what is used in the Well-Being Rmd file with the exception that in this file it adds in life expectancy in the even it may add value to review it. 

#The following is a dataframe based on this data and will be the base of all subsets for future things that are not modelled. 


df_subsetall3 <- df_subsetall2 %>% dplyr::select(curr_cols_all2) 
df_subsetall3 <- df_subsetall3[complete.cases(df_subsetall3),]
for (c in colnames(df_subsetall3)){
  df_subsetall3[[c]] <- drop.levels(df_subsetall3[[c]])
}
df_subsetall3 <- df_subsetall3[complete.cases(df_subsetall3),]
```

```{r}
#describe(df_subsetall3$sex)
```

##Training Data
```{r}
df_subsetbase <- df_subsetall3 %>% dplyr::select(-c(KHhyp12pB, KHbbmyo12, LifeExp))

subsettrainingRows <- sample(1:nrow(df_subsetbase), 0.8 * nrow(df_subsetbase))
subsettrainingData <- df_tmp[subsettrainingRows, ]
subsettestData <- df_tmp[-subsettrainingRows, ]
```

##Models

###Training polr Data Model
```{r}
#model based on training data
mt <- polr(as.factor(GZmehm1) ~ ., data = subsettrainingData, Hess=TRUE)

```

```{r}
df_model_sumt <- as.data.frame(coef(summary(mt)))

## calculate and store p values
df_model_sumt$p <- pnorm(abs(df_model_sumt$`t value`), lower.tail = FALSE) * 2

df_model_sumt$sig_col <- ifelse(df_model_sumt$p < 0.001,'***',ifelse(df_model_sumt$p < 0.01,'**',
                     ifelse(df_model_sumt$p < 0.05,'*',
                            ifelse(df_model_sumt$p < 0.1,'.', ''
                     ))))


df_model_sumt$logodds <- format(exp(df_model_sumt$Value), trim = TRUE, digits = 3, scientific = F)

df_meta_lvls$coeff_label <- paste0(df_meta_lvls$Varname,df_meta_lvls$numLevel)
df_model_sumt <- setDT(df_model_sumt, keep.rownames = TRUE)[]
df_model_sumt <- df_model_sumt %>% dplyr::rename(coeff_label = rn)
df_model_sumt <- df_model_sumt %>% left_join((df_meta_lvls %>% dplyr::select(c(coeff_label, ThemeEn, Varname, VarLabelEn, textLabelEn))), by="coeff_label")
df_model_sumt <- df_model_sumt %>% rename(Training_value = Value, Training_Std.Error = `Std. Error`, Training_T.Value = `t value`, Training_p = p, Training_Sig = sig_col, Training_logodds = logodds)

#library(kableExtra)

df_model_sumt %>%
  kable(booktabs = T, caption = "Training Data Table" , digits = 4) %>%
  kable_styling(bootstrap_options = c("striped", "hold_position")) #%>%
  #add_header_above(c(" ", "Training" = 2, "Training2"= 2, "Training3"= 2, " " =4)) %>%
  #add_footnote("footnote")

```

###Full Dataset polr model
```{r}
#model based on complete dataset
md <- polr(as.factor(GZmehm1) ~ ., data = df_subsetbase, Hess=TRUE)
#summary(md)

```

```{r}
df_model_sumd <- as.data.frame(coef(summary(md)))

## calculate and store p values
df_model_sumd$p <- pnorm(abs(df_model_sumd$`t value`), lower.tail = FALSE) * 2

df_model_sumd$sig_col <- ifelse(df_model_sumd$p < 0.001,'***',ifelse(df_model_sumd$p < 0.01,'**',
                     ifelse(df_model_sumd$p < 0.05,'*',
                            ifelse(df_model_sumd$p < 0.1,'.', ''
                     ))))


df_model_sumd$logodds <- format(exp(df_model_sumd$Value), trim = TRUE, digits = 3, scientific = F)

df_meta_lvls$coeff_label <- paste0(df_meta_lvls$Varname,df_meta_lvls$numLevel)
df_model_sumd <- setDT(df_model_sumd, keep.rownames = TRUE)[]
df_model_sumd <- df_model_sumd %>% dplyr::rename(coeff_label = rn)
df_model_sumd <- df_model_sumd %>% left_join((df_meta_lvls %>% dplyr::select(c(coeff_label, ThemeEn, Varname, VarLabelEn, textLabelEn))), by="coeff_label")
df_model_sumd <- df_model_sumd %>% rename(Full_value = Value, Full_Std.Error = `Std. Error`, Full_T.Value = `t value`, Full_p = p, Full_Sig = sig_col, Full_logodds = logodds)

df_model_sumd %>%
  kable(booktabs = T, caption = "Full Dataset Table", digits = 4 ) %>%
  kable_styling(bootstrap_options = c("striped", "hold_position"))

```

###Comparison of Training vs Full Dataset models
```{r}
#Model to join and compare differences between the full dataset and the dataset model and the training data model 
df_model_sumall <- dplyr::full_join(df_model_sumd, df_model_sumt, by = "coeff_label")
df_model_sumall <- df_model_sumall %>% dplyr::select(-c(Varname.y, VarLabelEn.y, ThemeEn.y, textLabelEn.y))
df_model_sumall <- df_model_sumall %>% dplyr::select(c("coeff_label", "Full_value", "Training_value", "Full_Std.Error", "Training_Std.Error", "Full_T.Value", "Training_T.Value", "Full_p", "Training_p", "Full_Sig", "Training_Sig", "Full_logodds", "Training_logodds", "ThemeEn.x", "Varname.x", "VarLabelEn.x", "textLabelEn.x"))

df_model_sumall %>%
  kable(booktabs = T, caption = "Comparison of Training & Full Datasets" , digits = 4) %>%
  kable_styling(bootstrap_options = c("striped", "hold_position")) 
```




```{r}
df_model_sumd <- df_model_sumd %>% rename(Value = Full_value , Std_Error =  Full_Std.Error, T_Value = Full_T.Value, p_value = Full_p, Sig = Full_Sig, Logodds = Full_logodds)

df_model_sumd <- df_model_sumd %>% dplyr::select(-c(Value, T_Value, Varname))

df_model_sumd %>%
  kable(booktabs = T, caption = "Full Dataset Table", digits = 4) %>%
  kable_styling(bootstrap_options = c("striped", "hold_position")) 
```


```{r}
df_model_sumd2 <- df_model_sumd 

df_model_sumd2 <- df_model_sumd2[1:15,]


df_model_sumd2 %>%
  kable(booktabs = T, caption = "Age and Gender Example", digits = 4) %>%
  kable_styling(bootstrap_options = c("striped", "hold_position"), full_width = F) %>%   save_kable("data/agegenderexample.png")



```


```{r}
#Recreation of the significance for each variable theme, recreation of file titled 2.7_stat_sig_var.csv based on the significance in the full dataset model. 
df_modelsig <- reshape2::dcast(df_model_sumd, ThemeEn ~ Sig)
df_modelsig$significant <- (df_modelsig$`*` + df_modelsig$`**` + df_modelsig$`***` + df_modelsig$.)
df_modelsig <- df_modelsig %>% rename(Not_significant = Var.2)


df_modelsig <- df_modelsig %>% dplyr::select(c(ThemeEn, significant, Not_significant))
df_modelsig <- df_modelsig %>% pivot_longer(-ThemeEn, names_to = "condition", values_to = "value")

df_modelsig <- df_modelsig %>% rename(theme = ThemeEn)

df_modelsig %>%
  kable(booktabs = T, caption = "Significance Table" , digits = 4) %>%
  kable_styling(bootstrap_options = c("striped", "hold_position")) 

```

```{r}
var_sig3 <- read_csv("data/modelsig.csv")

ggplot(var_sig3, aes(fill=condition, x=reorder(theme, -value), y=value)) +
  geom_bar(position="stack", stat="identity") +
  labs(title = "Statistically significant variables", x = " ", y = " ", caption = "GEDA (2014 - 2015)") +
  theme_few() +
  theme(panel.border = element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        legend.title = element_blank(),
        axis.line = element_line(color = "gray"),
        axis.ticks.x = element_blank(),
        axis.ticks.y = element_blank()) +
  theme(axis.text.x = element_text(angle = 90)) +
  scale_fill_manual(values = c("gray", "lightblue"))
```


## Gender Subsets

```{r}
#Gender subsets
df_subset_female <- filter(df_subsetall3, sex == "2")
df_subset_female <- df_subset_female %>% dplyr::select(-c(KHhyp12pB, KHbbmyo12, sex, LifeExp)) 

df_subset_male <- filter(df_subsetall3, sex == "1")
df_subset_male <- df_subset_male %>% dplyr::select(-c(KHhyp12pB, KHbbmyo12, sex, LifeExp))


```

```{r}
#create training/test date
df_fem_base <- df_subset_female 

#run ordinal logistic regression
m_female <- polr(GZmehm1 ~ ., data = df_fem_base, Hess=TRUE)


df_model_female <- as.data.frame(coef(summary(m_female)))

## calculate and store p values
df_model_female$p <- pnorm(abs(df_model_female$`t value`), lower.tail = FALSE) * 2

df_model_female$sig_col <- ifelse(df_model_female$p < 0.001,'***',ifelse(df_model_female$p < 0.01,'**',
                     ifelse(df_model_female$p < 0.05,'*',
                            ifelse(df_model_female$p < 0.1,'.', ''
                     ))))


df_model_female$logodds <- format(exp(df_model_female$Value), trim = TRUE, digits = 3, scientific = F)

df_meta_lvls$coeff_label <- paste0(df_meta_lvls$Varname,df_meta_lvls$numLevel)
df_model_female <- setDT(df_model_female, keep.rownames = TRUE)[]
df_model_female <- df_model_female %>% dplyr::rename(coeff_label = rn)
df_model_female <- df_model_female %>% left_join((df_meta_lvls %>% dplyr::select(c(coeff_label, ThemeEn, Varname, VarLabelEn, textLabelEn))), by="coeff_label")
df_model_female <- df_model_female %>% rename(Female_value = Value, Female_Std.Error = `Std. Error`, Female_T.Value = `t value`, Female_p = p, Female_Sig = sig_col, Female_logodds = logodds)

df_model_female %>%
  kable(booktabs = T, caption = "Female Table", digits = 4) %>%
  kable_styling(bootstrap_options = c("striped", "hold_position"))
```


```{r}
df_male_base <- df_subset_male 

#run ordinal logistic regression
m_male <- polr(GZmehm1 ~ ., data = df_male_base, Hess=TRUE)


df_model_male <- as.data.frame(coef(summary(m_male)))

## calculate and store p values
df_model_male$p <- pnorm(abs(df_model_male$`t value`), lower.tail = FALSE) * 2

df_model_male$sig_col <- ifelse(df_model_male$p < 0.001,'***',ifelse(df_model_male$p < 0.01,'**',
                     ifelse(df_model_male$p < 0.05,'*',
                            ifelse(df_model_male$p < 0.1,'.', ''
                     ))))


df_model_male$logodds <- format(exp(df_model_male$Value), trim = TRUE, digits = 3, scientific = F)

df_meta_lvls$coeff_label <- paste0(df_meta_lvls$Varname,df_meta_lvls$numLevel)
df_model_male <- setDT(df_model_male, keep.rownames = TRUE)[]
df_model_male <- df_model_male %>% dplyr::rename(coeff_label = rn)
df_model_male <- df_model_male %>% left_join((df_meta_lvls %>% dplyr::select(c(coeff_label, ThemeEn, Varname, VarLabelEn, textLabelEn))), by="coeff_label")
df_model_male <- df_model_male %>% rename(Male_value = Value, Male_Std.Error = `Std. Error`, Male_T.Value = `t value`, Male_p = p, Male_Sig = sig_col, Male_logodds = logodds)

df_model_male %>%
  kable(booktabs = T, caption = "Male Table", digits = 4) %>%
  kable_styling(bootstrap_options = c("striped", "hold_position")) 
```

###Table 3
```{r}
subsetCirrhosis_df1 <- reshape2::dcast(df_subsetall3, GZmehm1 ~ KHlz12)

subsetCirrhosis_df1$propYes <- subsetCirrhosis_df1[,2]/(subsetCirrhosis_df1[,3]+subsetCirrhosis_df1[,2])
subsetCirrhosis_df1$propNo <- subsetCirrhosis_df1[,3]/(subsetCirrhosis_df1[,3] +subsetCirrhosis_df1[,2])
subsetCirrhosis_df1$propWBYes <- subsetCirrhosis_df1[,2]/sum(subsetCirrhosis_df1[,2])
subsetCirrhosis_df1$propWBNo <- subsetCirrhosis_df1[,3]/sum(subsetCirrhosis_df1[,3])


subsetCirrhosis_df1 <- subsetCirrhosis_df1 %>% rename(Yes = `1`, No = `2`)
colnames(subsetCirrhosis_df1) <- c("GZmehm1", "Yes", "No", "Yes", "No", "Yes", "No")

subsetCirrhosis_df1 %>%
  kable(booktabs = T, caption = "Cirrhosis population table", digits = 4) %>%
  kable_styling(bootstrap_options = c("striped", "hold_position"), full_width = F) %>%
  add_header_above(c(" ", "Response" = 2, "Prop. Response"= 2, "Prop. in Level"= 2)) %>%    save_kable("data/images/cirrhosispopulation.png")

```

###Table 4
```{r}
df_model_sumallsort <- df_model_sumd
df_model_sumallsort <- df_model_sumallsort[c(1:220),]

df_model_sumallsort$Logodds <- as.numeric(df_model_sumallsort$Logodds)
df_model_sumallsort <- df_model_sumallsort[order(-df_model_sumallsort$Logodds),]
df_model_top10most <- df_model_sumallsort[1:10,]
rownames(df_model_top10most) <- c()

df_model_top10most %>%
  kable(booktabs = T, caption = "Top 10 most likely to have a positive impact", digits = 4) %>%
  kable_styling(bootstrap_options = c("striped", "hold_position"), full_width = F) %>%    save_kable("data/images/top10most.png")

```

###Table 5
```{r}
df_model_sumallRevsort <- df_model_sumd
df_model_sumallRevsort <- df_model_sumallRevsort[c(1:220),]

df_model_sumallRevsort$Logodds <- as.numeric(df_model_sumallRevsort$Logodds)
df_model_sumallRevsort <- df_model_sumallRevsort[order(df_model_sumallRevsort$Logodds),]

df_model_top10least <- df_model_sumallRevsort[1:10,]
rownames(df_model_top10least) <- c()


df_model_top10least %>%
  kable(booktabs = T, caption = "Top 10 most likely to have a negative impact", digits = 4) %>%
  kable_styling(bootstrap_options = c("striped", "hold_position"), full_width = F) %>%    save_kable("data/images/top10least.png")
```


### Table 23 Comparison of Male vs Female significant drivers
```{r}
#Model to join and compare differences between Male and Female datasets using the full dataset not the training dataset 
df_model_genders <- dplyr::full_join(df_model_male, df_model_female, by = "coeff_label")
df_model_genders <- df_model_genders %>% dplyr::select(-c(Varname.y, VarLabelEn.y, ThemeEn.y, textLabelEn.y))

df_model_genders <- df_model_genders %>% dplyr::select(c("coeff_label", "Male_Std.Error", "Female_Std.Error", "Male_p", "Female_p", "Male_Sig", "Female_Sig", "Male_logodds", "Female_logodds", "ThemeEn.x", "VarLabelEn.x", "textLabelEn.x"))

df_model_genders <- df_model_genders %>% filter(Male_p <= .1 | Female_p <= .1)

colnames(df_model_genders) = c('coeff_label', 'Men', 'Women','Men', 'Women','Men', 'Women','Men','Women', 'ThemeEn', 'VarLabelEn', 'TextLabelEn')

df_model_genders %>%
  kable(booktabs = T, caption = "Significance difference between men and women", digits = 4) %>%
  kable_styling(bootstrap_options = c("striped", "hold_position")) %>%
  add_header_above(c(" ", "Std.Error"= 2,  "p-value"= 2, "Significant"= 2, "Logodds"= 2, " " =3)) #%>%

```



```{r}
#Viewing the significance of various aspects of AGE & GENDER, which are or are not significant
df_model_subsetAgeGender <- df_model_sumd %>% filter(str_detect(ThemeEn, "1701"))
df_model_subsetAgeGender %>%
  kable(booktabs = T, caption = "Age and Gender Significance", digits = 4) %>%
  kable_styling(bootstrap_options = c("striped", "hold_position"), full_width = F) %>%    save_kable("data/images/ageandgender2.png") 
```

```{r}
describe(df_subsetall3$sex)
```

###Table 6
```{r}
subsetGender_df1 <- reshape2::dcast(df_subsetall3, GZmehm1 ~ sex)
subsetGender_df1$propMale <- subsetGender_df1[,2]/(subsetGender_df1[,3] + subsetGender_df1[,2])
subsetGender_df1$propFemale <- subsetGender_df1[,3]/(subsetGender_df1[,3] + subsetGender_df1[,2])
subsetGender_df1 <- subsetGender_df1 %>% rename(Male = `1`, Female = `2`)
subsetGender_df1$propWBMale <- subsetGender_df1[,2]/sum(subsetGender_df1[,2])
subsetGender_df1$propWBFemale <- subsetGender_df1[,3]/sum(subsetGender_df1[,3])

colnames(subsetGender_df1) = c('GZmehm1', 'Male', 'Female','Male', 'Female','Male', 'Female')

subsetGender_df1 %>%
  kable(booktabs = T, caption = "Male and female dataset population", digits = 4) %>%
  kable_styling(bootstrap_options = c("striped", "hold_position"), full_width = F) %>%
  add_header_above(c(" ", "Population" = 2, "Prop Response "= 2, "Prop in Level" = 2)) %>% save_kable("data/images/ageandgenderpopulation.png") 
```


## Alcohol Subsets

```{r}
describe(df_subsetall3$AKoft12_k)
```

###Table 7 
```{r}
#Viewing the significance of various aspects of ALCOHOL, which are or are not significant
df_model_subsetAlcohol <- df_model_sumd %>% filter(str_detect(ThemeEn, "1504"))
df_model_subsetAlcohol <- df_model_subsetAlcohol %>% dplyr::select(-ThemeEn)

df_model_subsetAlcohol %>%
  kable(booktabs = T, caption = "Alcohol Frequency Consumed Significance Table", digits = 4) %>%
  kable_styling(bootstrap_options = c("striped", "hold_position"), full_width = F) %>%    save_kable("data/images/alcoholconsumptionfrequencysignificance.png")

```

```{r}
subsetAlcohol_df1 <- reshape2::dcast(df_subsetall3, GZmehm1 ~ AKoft12_k)
subsetAlcohol_df1$propDaily <- subsetAlcohol_df1[,2]/sum(subsetAlcohol_df1[,2])
subsetAlcohol_df1$propWeekly <- subsetAlcohol_df1[,3]/sum(subsetAlcohol_df1[,3])
subsetAlcohol_df1$propMonthly <- subsetAlcohol_df1[,4]/sum(subsetAlcohol_df1[,4])
subsetAlcohol_df1$propLessthanmonthly <- subsetAlcohol_df1[,5]/sum(subsetAlcohol_df1[,5])
subsetAlcohol_df1$propNomore <- subsetAlcohol_df1[,6]/sum(subsetAlcohol_df1[,6])
subsetAlcohol_df1$propNone <- subsetAlcohol_df1[,7]/sum(subsetAlcohol_df1[,7])
subsetAlcohol_df1 <- subsetAlcohol_df1 %>% rename(Daily = `1`, Weekly = `2`, Monthly = `5`, LessMonthly = `7`, NoMore = `8`, None = `9`)

subsetAlcohol_df1$propWBDaily <- subsetAlcohol_df1[,2]/(subsetAlcohol_df1[,2] + subsetAlcohol_df1[,3] + subsetAlcohol_df1[,4]+ subsetAlcohol_df1[,5] + subsetAlcohol_df1[,6] + subsetAlcohol_df1[,7])
subsetAlcohol_df1$propWBWeekly <- subsetAlcohol_df1[,3]/(subsetAlcohol_df1[,2] + subsetAlcohol_df1[,3] + subsetAlcohol_df1[,4]+ subsetAlcohol_df1[,5] + subsetAlcohol_df1[,6] + subsetAlcohol_df1[,7])
subsetAlcohol_df1$propWBMonthly <- subsetAlcohol_df1[,4]/(subsetAlcohol_df1[,2] + subsetAlcohol_df1[,3] + subsetAlcohol_df1[,4]+ subsetAlcohol_df1[,5] + subsetAlcohol_df1[,6] + subsetAlcohol_df1[,7])
subsetAlcohol_df1$propWBLessthanmonthly <- subsetAlcohol_df1[,5]/(subsetAlcohol_df1[,2] + subsetAlcohol_df1[,3] + subsetAlcohol_df1[,4]+ subsetAlcohol_df1[,5] + subsetAlcohol_df1[,6] + subsetAlcohol_df1[,7])
subsetAlcohol_df1$propWBNomore <- subsetAlcohol_df1[,6]/(subsetAlcohol_df1[,2] + subsetAlcohol_df1[,3] + subsetAlcohol_df1[,4]+ subsetAlcohol_df1[,5] + subsetAlcohol_df1[,6] + subsetAlcohol_df1[,7])
subsetAlcohol_df1$propWBNone <- subsetAlcohol_df1[,7]/(subsetAlcohol_df1[,2] + subsetAlcohol_df1[,3] + subsetAlcohol_df1[,4]+ subsetAlcohol_df1[,5] + subsetAlcohol_df1[,6] + subsetAlcohol_df1[,7])
#subsetAlcohol_df1 <- subsetAlcohol_df1 %>% rename(Daily = `1`, Weekly = `2`, Monthly = `5`, LessMonthly = `7`, NoMore = `8`, None = `9`)


subsetAlcohol_df1 %>%
  kable(booktabs = T, caption = "Alcohol Population Table", digits = 4) %>%
  kable_styling(bootstrap_options = c("striped", "hold_position")) #%>%
 # add_header_above(c(" ", "Frequency" = 6, "Frequency Proportion"= 6, "Well-being Proportion"= 6, " " =4)) #%>%
  #add_footnote("footnote")

#(subsetAlcohol_df1[,2] + sum(subsetAlcohol_df1[,3] + sum(subsetAlcohol_df1[,4]+ sum(subsetAlcohol_df1[,5] + sum(subsetAlcohol_df1[,6] + sum(subsetAlcohol_df1[,7])
```

## Disease Subsets

###Table 8
```{r}
#Viewing the significance of various aspects of DISEASES, which are or are not significant
df_model_subsetDisease <- df_model_sumd %>% filter(str_detect(ThemeEn, "1101"))
df_model_subsetDisease <- df_model_subsetDisease %>% dplyr::select(-ThemeEn)

df_model_subsetDisease %>%
  kable(booktabs = T, caption = "Disease Significance Table", digits = 4) %>%
  kable_styling(bootstrap_options = c("striped", "hold_position"), full_width = F) %>%    save_kable("data/images/diseasesignificance.png") #%>%
  #add_header_above(c(" ", "Training" = 2, "Training2"= 2, "Training3"= 2, " " =4)) %>%
  #add_footnote("footnote")
```

### Table 9 
```{r}
#Viewing the significance of various aspects of HEALTH FOCUS AND LIMITATIONS, which are or are not significant
df_model_subsetHealth <- df_model_sumd %>% filter(str_detect(ThemeEn, "1102"))

df_model_subsetHealth %>%
  kable(booktabs = T, caption = "Health focus and limitations significance table", digits = 4) %>%
  kable_styling(bootstrap_options = c("striped", "hold_position"), full_width = F) %>%        save_kable("data/images/health_focus_limitations_significance.png")
```

### Table 10
```{r}
subsetChronicDiseases_df1 <- reshape2::dcast(df_subsetall3, GZmehm1 ~ GZmehm3C)

subsetChronicDiseases_df1$propYes <- subsetChronicDiseases_df1[,2]/(subsetChronicDiseases_df1[,2] + subsetChronicDiseases_df1[,3])
subsetChronicDiseases_df1$propNo <- subsetChronicDiseases_df1[,3]/(subsetChronicDiseases_df1[,2] + subsetChronicDiseases_df1[,3])

subsetChronicDiseases_df1$propWBYes <- subsetChronicDiseases_df1[,2]/sum(subsetChronicDiseases_df1[,2])
subsetChronicDiseases_df1$propWBNo <- subsetChronicDiseases_df1[,3]/sum(subsetChronicDiseases_df1[,3])

subsetChronicDiseases_df1 <- subsetChronicDiseases_df1 %>% rename(Yes = `1`, No = `2`)
colnames(subsetChronicDiseases_df1) = c('GZmehm1', 'Yes', 'No','Yes', 'No','Yes', 'No')

subsetChronicDiseases_df1 %>%
  kable(booktabs = T, caption = "Chronic disease population table", digits = 4) %>%
  kable_styling(bootstrap_options = c("striped", "hold_position")) %>%
  add_header_above(c(" ", "Response" = 2, "Prop Response"= 2, "Prop in Level"= 2)) %>%        save_kable("data/images/chronic_disease_population.png")
```

###Table 11
```{r}
subsetChronicDiseases_df2 <- reshape2::dcast(df_subsetall3, GZmehm1 ~ GZmehm2D)

subsetChronicDiseases_df2$propStrongly <- subsetChronicDiseases_df2[,2]/(subsetChronicDiseases_df2[,2] + subsetChronicDiseases_df2[,3] + subsetChronicDiseases_df2[,4])
subsetChronicDiseases_df2$propModerately <- subsetChronicDiseases_df2[,3]/(subsetChronicDiseases_df2[,2] + subsetChronicDiseases_df2[,3] + subsetChronicDiseases_df2[,4])
subsetChronicDiseases_df2$propNotlimited <- subsetChronicDiseases_df2[,4]/(subsetChronicDiseases_df2[,2] + subsetChronicDiseases_df2[,3] + subsetChronicDiseases_df2[,4])

subsetChronicDiseases_df2$propWBStrongly <- subsetChronicDiseases_df2[,2]/sum(subsetChronicDiseases_df2[,2])
subsetChronicDiseases_df2$propWBModerately <- subsetChronicDiseases_df2[,3]/sum(subsetChronicDiseases_df2[,3])
subsetChronicDiseases_df2$propWBNotlimited <- subsetChronicDiseases_df2[,4]/sum(subsetChronicDiseases_df2[,4])
subsetChronicDiseases_df2 <- subsetChronicDiseases_df2 %>% rename(Strongly_Limited = `1`, Moderately_Restricted = `2`, Not_Limited = `3`)

colnames(subsetChronicDiseases_df2) = c('GZmehm1', 'Strongly', 'Moderately', 'None', 'Strongly', 'Moderately','None', 'Strongly', 'Moderately', 'None')

subsetChronicDiseases_df2 %>%
  kable(booktabs = T, caption = "Restricted/limited population table", digits = 4) %>%
  kable_styling(bootstrap_options = c("striped", "hold_position")) %>%
  add_header_above(c(" ", "Degree of limitation Response" = 3, "Prop of Response"= 3, "Prop in Level"= 3)) %>% save_kable("data/images/limitation_population_table.png")
```

###Table 12
```{r}
#Viewing the significance of various aspects of MENTAL HEALTH, which are or are not significant
df_model_subsetMentalHealth <- df_model_sumd %>% filter(str_detect(ThemeEn, "1301"))

df_model_subsetMentalHealth %>%
  kable(booktabs = T, caption = "Mental health significance table", digits = 4) %>%
  kable_styling(bootstrap_options = c("striped", "hold_position"), full_width = F) %>%    save_kable("data/images/mental_health_significance.png")
```


###Table 13
```{r}
#Viewing the significance of various aspects of BIRTHPLACE AND CITIZENSHIP, which are or are not significant
df_model_subsetMigration <- df_model_sumd %>% filter(str_detect(ThemeEn, "1705"))
df_model_subsetMigration <- df_model_subsetMigration %>% dplyr::select(-ThemeEn) 

df_model_subsetMigration %>%
  kable(booktabs = T, caption = "Birthplace and citizenship significance table", digits = 4) %>%
  kable_styling(bootstrap_options = c("striped", "hold_position"), full_width = F)  %>%    save_kable("data/images/migration_significance.png")
```

###Table 14

```{r}
#where born subsets
subsetgermanborn_df1 <- reshape2::dcast(df_subsetall3, GZmehm1 ~ MIbirthplace)
subsetgermanborn_df1$propGermany <- subsetgermanborn_df1[,2]/(subsetgermanborn_df1[,2] + subsetgermanborn_df1[,3] + subsetgermanborn_df1[,4])
subsetgermanborn_df1$propEU <- subsetgermanborn_df1[,3]/(subsetgermanborn_df1[,2] + subsetgermanborn_df1[,3] + subsetgermanborn_df1[,4])
subsetgermanborn_df1$propNonEU <- subsetgermanborn_df1[,4]/(subsetgermanborn_df1[,2] + subsetgermanborn_df1[,3] + subsetgermanborn_df1[,4])

subsetgermanborn_df1$propWBGermany <- subsetgermanborn_df1[,2]/sum(subsetgermanborn_df1[,2])
subsetgermanborn_df1$propWBEU <- subsetgermanborn_df1[,3]/sum(subsetgermanborn_df1[,3])
subsetgermanborn_df1$propWBNonEU <- subsetgermanborn_df1[,4]/sum(subsetgermanborn_df1[,4])

subsetgermanborn_df1 <- subsetgermanborn_df1 %>% rename(Germany = `10`, Other_EU_Country = `21`, Non_EU_Country = `22`)

colnames(subsetgermanborn_df1) = c('GZmehm1', 'Germany', 'EU', 'Non_EU', 'Germany', 'EU', 'Non_EU',  'Germany', 'EU', 'Non_EU')

subsetgermanborn_df1 %>%
  kable(booktabs = T, caption = "Birthplace population table", digits = 4) %>%
  kable_styling(bootstrap_options = c("striped", "hold_position"), full_width = F) %>%
  add_header_above(c(" ", "Where Born Response" = 3, "Prop Response"= 3, "Prop in Level" = 3))  %>%    save_kable("data/images/birthplace_population_table.png")
  #add_footnote("footnote")
```

## Table 15
```{r}
#citizen subsets
subsetgermancitizen_df1 <- reshape2::dcast(df_subsetall3, GZmehm1 ~ MIcitizen)

subsetgermancitizen_df1$propGermany <- subsetgermancitizen_df1[,2]/(subsetgermancitizen_df1[,2] + subsetgermancitizen_df1[,3] + subsetgermancitizen_df1[,4])
subsetgermancitizen_df1$propEU <- subsetgermancitizen_df1[,3]/(subsetgermancitizen_df1[,2] + subsetgermancitizen_df1[,3] + subsetgermancitizen_df1[,4])
subsetgermancitizen_df1$propNonEU <- subsetgermancitizen_df1[,4]/(subsetgermancitizen_df1[,2] + subsetgermancitizen_df1[,3] + subsetgermancitizen_df1[,4])

subsetgermancitizen_df1$propWBGermany <- subsetgermancitizen_df1[,2]/sum(subsetgermancitizen_df1[,2])
subsetgermancitizen_df1$propWBEU <- subsetgermancitizen_df1[,3]/sum(subsetgermancitizen_df1[,3])
subsetgermancitizen_df1$propWBNonEU <- subsetgermancitizen_df1[,4]/sum(subsetgermancitizen_df1[,4])

subsetgermancitizen_df1 <- subsetgermancitizen_df1 %>% rename(Germany = `10`, Other_EU_Country = `21`, Non_EU_Country = `22`)

colnames(subsetgermancitizen_df1) = c('GZmehm1', 'German', 'EU', 'Non_EU', 'German', 'EU', 'Non_EU',  'German', 'EU', 'Non_EU')

subsetgermancitizen_df1 %>%
  kable(booktabs = T, caption = "Citizenship population table", digits = 4) %>%
  kable_styling(bootstrap_options = c("striped", "hold_position"), full_width = F) %>%
  add_header_above(c(" ", "Citizenship Reponse" = 3, "Prop Response"= 3, "Proportion in   Level" = 3)) %>% 
  save_kable("data/images/citizenship_population_table.png")

```


##Table 16 Personal theme that include household structure and BMI
```{r}
#Viewing the significance of various aspects of HOUSEHOLD STRUCTURE AND BMI, which are or are not significant
df_model_subsetPersData <- df_model_sumd %>% filter(str_detect(ThemeEn, "1702"))
df_model_subsetPersData <- df_model_subsetPersData %>% dplyr::select(-ThemeEn)  

df_model_subsetPersData %>%
  kable(booktabs = T, caption = "Household structure and BMI significance", digits = 4) %>%
  kable_styling(bootstrap_options = c("striped", "hold_position"), full_width = F) %>%    save_kable("data/images/household_BMI_significance.png")
```


###Table 17 
```{r}
#Viewing the significance of various aspects of QUALITY OF LIFE, which are or are not significant
df_model_subsetQOL <- df_model_sumd %>% filter(str_detect(ThemeEn, "1109"))
df_model_subsetQOL <- df_model_subsetQOL %>% dplyr::select(-ThemeEn)
df_model_subsetQOL %>%
  kable(booktabs = T, caption = "Quality of life significance table", digits = 4) %>%
  kable_styling(bootstrap_options = c("striped", "hold_position"), full_width = F) %>%    save_kable("data/images/QOL_significance_table.png")
```

###Table 18 
```{r}
subsetQOLIntensity_df1 <- reshape2::dcast(df_subsetall3, GZmehm1 ~ LQsf367C)

subsetQOLIntensity_df1$propNoPain <- subsetQOLIntensity_df1[,2]/(subsetQOLIntensity_df1[,7] + subsetQOLIntensity_df1[,2] +subsetQOLIntensity_df1[,3] +subsetQOLIntensity_df1[,4] + subsetQOLIntensity_df1[,5] + subsetQOLIntensity_df1[,6])
subsetQOLIntensity_df1$propVeryLightPain <- subsetQOLIntensity_df1[,2]/(subsetQOLIntensity_df1[,7] + subsetQOLIntensity_df1[,2] +subsetQOLIntensity_df1[,3] +subsetQOLIntensity_df1[,4] + subsetQOLIntensity_df1[,5] + subsetQOLIntensity_df1[,6])
subsetQOLIntensity_df1$propLightPain <- subsetQOLIntensity_df1[,3]/(subsetQOLIntensity_df1[,7] + subsetQOLIntensity_df1[,2] +subsetQOLIntensity_df1[,3] +subsetQOLIntensity_df1[,4] + subsetQOLIntensity_df1[,5] + subsetQOLIntensity_df1[,6])
subsetQOLIntensity_df1$propModeratePain <- subsetQOLIntensity_df1[,4]/(subsetQOLIntensity_df1[,7] + subsetQOLIntensity_df1[,2] +subsetQOLIntensity_df1[,3] +subsetQOLIntensity_df1[,4] + subsetQOLIntensity_df1[,5] + subsetQOLIntensity_df1[,6])
subsetQOLIntensity_df1$propStrongPain <- subsetQOLIntensity_df1[,5]/(subsetQOLIntensity_df1[,7] + subsetQOLIntensity_df1[,2] +subsetQOLIntensity_df1[,3] +subsetQOLIntensity_df1[,4] + subsetQOLIntensity_df1[,5] + subsetQOLIntensity_df1[,6])
subsetQOLIntensity_df1$propVeryStrongPain <- subsetQOLIntensity_df1[,6]/(subsetQOLIntensity_df1[,7] + subsetQOLIntensity_df1[,2] +subsetQOLIntensity_df1[,3] +subsetQOLIntensity_df1[,4] + subsetQOLIntensity_df1[,5] + subsetQOLIntensity_df1[,6])

subsetQOLIntensity_df1$propWBNoPain <- subsetQOLIntensity_df1[,2]/sum(subsetQOLIntensity_df1[,2])
subsetQOLIntensity_df1$propWBVeryLightPain <- subsetQOLIntensity_df1[,2]/sum(subsetQOLIntensity_df1[,2])
subsetQOLIntensity_df1$propWBLightPain <- subsetQOLIntensity_df1[,3]/sum(subsetQOLIntensity_df1[,3])
subsetQOLIntensity_df1$propWBModeratePain <- subsetQOLIntensity_df1[,4]/sum(subsetQOLIntensity_df1[,4])
subsetQOLIntensity_df1$propWBStrongPain <- subsetQOLIntensity_df1[,5]/sum(subsetQOLIntensity_df1[,5])
subsetQOLIntensity_df1$propWBVeryStrongPain <- subsetQOLIntensity_df1[,6]/sum(subsetQOLIntensity_df1[,6]) 

subsetQOLIntensity_df1 <- subsetQOLIntensity_df1 %>% rename(No_Pain = `1`, Light_Pain = `2`, Very_Light_Pain = `3`, Moderate_Pain =`4`, Strong_Pain =`5`, Very_Strong_Pain =`6`)

colnames(subsetQOLIntensity_df1) = c('GZmehm1', 'None', 'V_Light','Light', 'Moderate','Strong', 'V_Strong', 'None', 'V_Light','Light', 'Moderate','Strong', 'V_Strong','None', 'V_Light','Light', 'Moderate','Strong', 'V_Strong' )

subsetQOLIntensity_df1 %>%
  kable(booktabs = T, caption = "BMI population table", digits = 4) %>%
  kable_styling(bootstrap_options = c("striped", "hold_position")) %>%
  add_header_above(c(" ", "Pain Intensity Response" = 6, "Prop Response"= 6, "Prop in Level" = 6)) %>%    save_kable("data/images/pain_population_table.png")
```

###Table 19 
```{r}
#Viewing the significance of various aspects of SMOKING, which are or are not significant
df_model_subsetSmoking <- df_model_sumd %>% filter(str_detect(ThemeEn, "1505"))
df_model_subsetSmoking <- df_model_subsetSmoking%>% dplyr::select(-ThemeEn)

df_model_subsetSmoking %>%
  kable(booktabs = T, caption = "Smoking significance table", digits = 4) %>%
  kable_styling(bootstrap_options = c("striped", "hold_position"), full_width = F) %>%    save_kable("data/images/smoking_significance_table.png") 
```

###Table 20
```{r}
subsetsmoke_df1 <- reshape2::dcast(df_subsetall3, GZmehm1 ~ RCstat)

subsetsmoke_df1$propDaily <- subsetsmoke_df1[,2]/(subsetsmoke_df1[,2] + subsetsmoke_df1[,3] + subsetsmoke_df1[,4] + subsetsmoke_df1[,5])
subsetsmoke_df1$propOcc <- subsetsmoke_df1[,3]/(subsetsmoke_df1[,2] + subsetsmoke_df1[,3] + subsetsmoke_df1[,4] + subsetsmoke_df1[,5])
subsetsmoke_df1$propQuit <- subsetsmoke_df1[,4]/(subsetsmoke_df1[,2] + subsetsmoke_df1[,3] + subsetsmoke_df1[,4] + subsetsmoke_df1[,5])
subsetsmoke_df1$propNeverSmoked <- subsetsmoke_df1[,5]/(subsetsmoke_df1[,2] + subsetsmoke_df1[,3] + subsetsmoke_df1[,4] + subsetsmoke_df1[,5])

subsetsmoke_df1$propWBDaily <- subsetsmoke_df1[,2]/sum(subsetsmoke_df1[,2])
subsetsmoke_df1$propWBOcc <- subsetsmoke_df1[,3]/sum(subsetsmoke_df1[,3])
subsetsmoke_df1$propWBQuit <- subsetsmoke_df1[,4]/sum(subsetsmoke_df1[,4])
subsetsmoke_df1$propWBNeverSmoked <- subsetsmoke_df1[,5]/sum(subsetsmoke_df1[,5])

subsetsmoke_df1 <- subsetsmoke_df1 %>% rename(Daily = `1`, Occasionally = `2`, Quit = `3`, Neversmoked = `4`)

colnames(subsetsmoke_df1) = c('GZmehm1', 'Daily', 'Occ','Quit', 'Never','Daily', 'Occ','Quit', 'Never', 'Daily', 'Occ','Quit', 'Never')

subsetsmoke_df1 %>%
  kable(booktabs = T, caption = "Smoking population table", digits = 4) %>%
  kable_styling(bootstrap_options = c("striped", "hold_position")) %>%
  add_header_above(c(" ", "Smoking Status Response" = 4, "Prop Response"= 4, "Prop in Level" = 4)) %>%    save_kable("data/images/smoking_population_table.png") 
```

### Table 21 Insurance and medical tests
```{r}
#Viewing the significance of various aspects of TYPE OF HEALTH INSURANCE AND PRIOR MEDICAL TEST RESULTS, which are or are not significant
df_model_subsetUse <- df_model_sumd %>% filter(str_detect(ThemeEn, "1401"))
df_model_subsetUse <- df_model_subsetUse %>% dplyr::select(-ThemeEn)
df_model_subsetUse <- df_model_subsetUse %>% filter(p_value <= .1)

df_model_subsetUse %>%
  kable(booktabs = T, caption = "Insurance and medical tests", digits = 4) %>%
  kable_styling(bootstrap_options = c("striped", "hold_position"), full_width = F) %>%    save_kable("data/images/insurance_tests_table.png")
```

```{r}
#blood fat test no heart issues ( IAcholus )
df_subset_bloodfat12 <- df_subsetall3
df_subset_bloodfat12$ProactiveBFMonitor <- ifelse(df_subset_bloodfat12$IAcholus == 1 & df_subset_bloodfat12$KHmyo12 == 1 | df_subset_bloodfat12$KHkhk12 == 1 | df_subset_bloodfat12$KHhi12==1 | df_subset_bloodfat12$KHsa12 == 1, 2,1)


df_subset_BFnoProb <- filter(df_subset_bloodfat12, ProactiveBFMonitor == "1")
df_subset_BFwithProb <- filter(df_subset_bloodfat12, ProactiveBFMonitor == "2")
```

```{r}
subsetbloodfat12_df1 <- reshape2::dcast(df_subsetall3, GZmehm1 ~ IAcholus)

subsetbloodfat12_df1$proplast12 <- subsetbloodfat12_df1[,2]/sum(subsetbloodfat12_df1[,2])
subsetbloodfat12_df1$prop1to3 <- subsetbloodfat12_df1[,3]/sum(subsetbloodfat12_df1[,3])
subsetbloodfat12_df1$prop3to5 <- subsetbloodfat12_df1[,4]/sum(subsetbloodfat12_df1[,4])
subsetbloodfat12_df1$propmorethan5 <- subsetbloodfat12_df1[,5]/sum(subsetbloodfat12_df1[,5])
subsetbloodfat12_df1$propNever <- subsetbloodfat12_df1[,6]/sum(subsetbloodfat12_df1[,6])
```

### Table 22
```{r}


subsetbloodfat12_df2 <- reshape2::dcast(df_subset_bloodfat12, GZmehm1 ~ ProactiveBFMonitor)

subsetbloodfat12_df2$propYes <- subsetbloodfat12_df2[,2]/(subsetbloodfat12_df2[,2] + subsetbloodfat12_df2[,3])
subsetbloodfat12_df2$propNo <- subsetbloodfat12_df2[,3]/(subsetbloodfat12_df2[,2] + subsetbloodfat12_df2[,3])

subsetbloodfat12_df2$propWBYes <- subsetbloodfat12_df2[,2]/sum(subsetbloodfat12_df2[,2])
subsetbloodfat12_df2$propWBNo <- subsetbloodfat12_df2[,3]/sum(subsetbloodfat12_df2[,3])

colnames(subsetbloodfat12_df2) <- c("GZmehm1", "Yes", "No", "Yes", "No", "Yes", "No")

subsetbloodfat12_df2 %>%
  kable(booktabs = T, caption = "Proactive blood fat population table", digits = 4) %>%
  kable_styling(bootstrap_options = c("striped", "hold_position"), full_width = F) %>%
  add_header_above(c(" ", "Proactive Blood Fat Response" = 2, "Prop Response" = 2, "Prop in Level" = 2)) %>%    save_kable("data/images/proactive_blood_fat_population_table.png")
```






### Inflammatory Bowel Disease Subsets
```{r}
describe(df_subsetall3$KHced12)
```


```{r}
subsetIBD_df1 <- reshape2::dcast(df_subsetall3, GZmehm1 ~ KHced12)

subsetIBD_df1$propYes <- subsetIBD_df1[,2]/sum(subsetIBD_df1[,2])
subsetIBD_df1$propNo <- subsetIBD_df1[,3]/sum(subsetIBD_df1[,3])

subsetIBD_df1 <- subsetIBD_df1 %>% rename(Yes = `1`, No = `2`)

subsetIBD_df1 %>%
  kable(booktabs = T, caption = "Irritable Bowel Syndrome Population Table", digits = 4) %>%
  kable_styling(bootstrap_options = c("striped", "hold_position")) #%>%
  #add_header_above(c(" ", "Training" = 2, "Training2"= 2, "Training3"= 2, " " =4)) %>%
  #add_footnote("footnote")
```


```{r}
subsetCancer_df1 <- reshape2::dcast(df_subsetall3, GZmehm1 ~ KHkarz12)

subsetCancer_df1$propYes <- subsetCancer_df1[,2]/sum(subsetCancer_df1[,2])
subsetCancer_df1$propNo <- subsetCancer_df1[,3]/sum(subsetCancer_df1[,3])

subsetCancer_df1 <- subsetCancer_df1 %>% rename(Yes = `1`, No = `2`)

subsetCancer_df1 %>%
  kable(booktabs = T, caption = "Cancer population table", digits = 4) %>%
  kable_styling(bootstrap_options = c("striped", "hold_position")) #%>%
  #add_header_above(c(" ", "Training" = 2, "Training2"= 2, "Training3"= 2, " " =4)) %>%
  #add_footnote("footnote")
```

### Heart Failure Subsets

```{r}
describe(df_subsetall3$KHhi12)
```

```{r}
subsetHeartfailure_df1 <- reshape2::dcast(df_subsetall3, GZmehm1 ~ KHhi12)

subsetHeartfailure_df1$propWBYes <- subsetHeartfailure_df1[,2]/sum(subsetHeartfailure_df1[,2])
subsetHeartfailure_df1$propWBNo <- subsetHeartfailure_df1[,3]/sum(subsetHeartfailure_df1[,3])
subsetHeartfailure_df1$propYes <- subsetHeartfailure_df1[,2]/(subsetHeartfailure_df1[,2] + subsetHeartfailure_df1[,3])
subsetHeartfailure_df1$propNo <- subsetHeartfailure_df1[,3]/(subsetHeartfailure_df1[,2] + subsetHeartfailure_df1[,3])

subsetHeartfailure_df1 <- subsetHeartfailure_df1 %>% rename(Yes = `1`, No = `2`)

subsetHeartfailure_df1 %>%
  kable(booktabs = T, caption = "Heart failure population table", digits = 4) %>%
  kable_styling(bootstrap_options = c("striped", "hold_position")) #%>%
  #add_header_above(c(" ", "Training" = 2, "Training2"= 2, "Training3"= 2, " " =4)) %>%
  #add_footnote("footnote")
```

### High Blood Pressure Subsets
```{r}
describe(df_subsetall3$KHhyp12)
describe(df_subsetall3$KHhyp)
```


```{r}

subsetHighBPthisyear_df1 <- reshape2::dcast(df_subsetall3, GZmehm1 ~ KHhyp12)
subsetHighBPever_df1 <- reshape2::dcast(df_subsetall3, GZmehm1 ~ KHhyp)

subsetHighBPthisyear_df1$propYes <- subsetHighBPthisyear_df1[,2]/sum(subsetHighBPthisyear_df1[,2])
subsetHighBPthisyear_df1$propNo <- subsetHighBPthisyear_df1[,3]/sum(subsetHighBPthisyear_df1[,3])

subsetHighBPever_df1$propYes <- subsetHighBPever_df1[,2]/sum(subsetHighBPever_df1[,2])
subsetHighBPever_df1$propNo <- subsetHighBPever_df1[,3]/sum(subsetHighBPever_df1[,3])

subsetHighBPthisyear_df1 <- subsetHighBPthisyear_df1 %>% rename(Yes = `1`, No = `2`)
subsetHighBPever_df1 <- subsetHighBPever_df1 %>% rename(Yes = `1`, No = `2`)

subsetHighBPthisyear_df1 %>%
  kable(booktabs = T, caption = "Training Table", digits = 4) %>%
  kable_styling(bootstrap_options = c("striped", "hold_position")) #%>%
  #add_header_above(c(" ", "Training" = 2, "Training2"= 2, "Training3"= 2, " " =4)) %>%
  #add_footnote("footnote")

subsetHighBPever_df1 %>%
  kable(booktabs = T, caption = "Ever diagnosed with high blood pressure population table", digits = 4) %>%
  kable_styling(bootstrap_options = c("striped", "hold_position")) #%>%
  #add_header_above(c(" ", "Training" = 2, "Training2"= 2, "Training3"= 2, " " =4)) %>%
  #add_footnote("footnote")
```

### Diabetes Subsets

```{r}
#Diabetes subsets
df_subset_diabetes <- filter(df_subsetall3, KHdiabB12 == "1")
df_subset_nodiabetes <- filter(df_subsetall3, KHdiabB12 == "2")
df_subset_diabetes <- df_subset_diabetes %>% dplyr::select(-KHdiabB12)
df_subset_nodiabetes <- df_subset_nodiabetes %>% dplyr::select(-KHdiabB12)

```

```{r}
subsetdiabetes_df1 <- reshape2::dcast(df_subsetall3, GZmehm1 ~ KHdiabB12)
subsetdiabetes_df1$propYes <- subsetdiabetes_df1[,2]/sum(subsetdiabetes_df1[,2])
subsetdiabetes_df1$propNo <- subsetdiabetes_df1[,3]/sum(subsetdiabetes_df1[,3])
subsetHighBPthisyear_df1 <- subsetHighBPthisyear_df1 %>% rename(Yes = `1`, No = `2`)

subsetdiabetes_df1 %>%
  kable(booktabs = T, caption = "Diabetes population table", digits = 4) %>%
  kable_styling(bootstrap_options = c("striped", "hold_position")) #%>%
  #add_header_above(c(" ", "Training" = 2, "Training2"= 2, "Training3"= 2, " " =4)) %>%
  #add_footnote("footnote")
```

```{r}
#Viewing the significance of various aspects of IMPAIRMENTS AND DISABILITIES, which are or are not significant
df_model_subsetDisability <- df_model_sumd %>% filter(str_detect(ThemeEn, "1105"))

df_model_subsetDisability %>%
  kable(booktabs = T, caption = "Fig XX: Disability significance table", digits = 4) %>%
  kable_styling(bootstrap_options = c("striped", "hold_position")) #%>%
  #add_header_above(c(" ", "Training" = 2, "Training2"= 2, "Training3"= 2, " " =4)) %>%
  #add_footnote("footnote")


```

```{r}
subsetLowerBack12mos_df1 <- reshape2::dcast(df_subsetall3, GZmehm1 ~ BBdors112)
subsetLowerBack12mos_df1$propYes <- subsetLowerBack12mos_df1[,2]/sum(subsetLowerBack12mos_df1[,2])
subsetLowerBack12mos_df1$propNo <- subsetLowerBack12mos_df1[,3]/sum(subsetLowerBack12mos_df1[,3])
subsetLowerBack12mos_df1 <- subsetLowerBack12mos_df1 %>% rename(Yes = `1`, No = `2`)

subsetLowerBack12mos_df1 %>%
  kable(booktabs = T, caption = "Lower back population table", digits = 4) %>%
  kable_styling(bootstrap_options = c("striped", "hold_position")) #%>%
  #add_header_above(c(" ", "Training" = 2, "Training2"= 2, "Training3"= 2, " " =4)) %>%
  #add_footnote("footnote")
```

```{r}
subsetNeckSpine12mos_df1 <- reshape2::dcast(df_subsetall3, GZmehm1 ~ BBdors212)
subsetNeckSpine12mos_df1$propYes <- subsetNeckSpine12mos_df1[,2]/sum(subsetNeckSpine12mos_df1[,2])
subsetNeckSpine12mos_df1$propNo <- subsetNeckSpine12mos_df1[,3]/sum(subsetNeckSpine12mos_df1[,3])
subsetNeckSpine12mos_df1 <- subsetNeckSpine12mos_df1 %>% rename(Yes = `1`, No = `2`)

subsetNeckSpine12mos_df1 %>%
  kable(booktabs = T, caption = "Neck & spine population table", digits = 4) %>%
  kable_styling(bootstrap_options = c("striped", "hold_position")) #%>%
  #add_header_above(c(" ", "Training" = 2, "Training2"= 2, "Training3"= 2, " " =4)) %>%
  #add_footnote("footnote")
```


```{r}
subsetOfficialDisable_df1 <- reshape2::dcast(df_subsetall3, GZmehm1 ~ BBbehB)
subsetOfficialDisable_df1$propYes <- subsetOfficialDisable_df1[,2]/sum(subsetOfficialDisable_df1[,2])
subsetOfficialDisable_df1$propNo <- subsetOfficialDisable_df1[,3]/sum(subsetOfficialDisable_df1[,3])
subsetOfficialDisable_df1 <- subsetOfficialDisable_df1 %>% rename(Yes = `1`, No = `2`)

subsetOfficialDisable_df1 %>%
  kable(booktabs = T, caption = "Officially disable population table", digits = 4) %>%
  kable_styling(bootstrap_options = c("striped", "hold_position")) #%>%
  #add_header_above(c(" ", "Training" = 2, "Training2"= 2, "Training3"= 2, " " =4)) %>%
  #add_footnote("footnote")
```





```{r}
#Viewing the significance of various aspects of MEDICATIONS, which are or are not significant
df_model_subsetMedicines <- df_model_sumd %>% filter(str_detect(ThemeEn, "1403"))

df_model_subsetMedicines %>%
  kable(booktabs = T, caption = "Medication Significance", digits = 4) %>%
  kable_styling(bootstrap_options = c("striped", "hold_position")) #%>%
  #add_header_above(c(" ", "Training" = 2, "Training2"= 2, "Training3"= 2, " " =4)) %>%
  #add_footnote("footnote")
```

```{r}
subsetTakingmeds_df1 <- reshape2::dcast(df_subsetall3, GZmehm1 ~ AMarztB)
subsetTakingmeds_df1$propYes <- subsetTakingmeds_df1[,2]/sum(subsetTakingmeds_df1[,2])
subsetTakingmeds_df1$propNo <- subsetTakingmeds_df1[,3]/sum(subsetTakingmeds_df1[,3])
subsetTakingmeds_df1 <- subsetTakingmeds_df1 %>% rename(Yes = `1`, No = `2`)

subsetTakingmeds_df1 %>%
  kable(booktabs = T, caption = "Taking medication population table", digits = 4) %>%
  kable_styling(bootstrap_options = c("striped", "hold_position")) #%>%
  #add_header_above(c(" ", "Training" = 2, "Training2"= 2, "Training3"= 2, " " =4)) %>%
  #add_footnote("footnote")
```

```{r}
subsetTakingmeds_df2 <- reshape2::dcast(df_subsetall3, GZmehm1 ~ AMfrei)
subsetTakingmeds_df2$propYes <- subsetTakingmeds_df2[,2]/sum(subsetTakingmeds_df2[,2])
subsetTakingmeds_df2$propNo <- subsetTakingmeds_df2[,3]/sum(subsetTakingmeds_df2[,3])
subsetTakingmeds_df2 <- subsetTakingmeds_df2 %>% rename(Yes = `1`, No = `2`)

subsetTakingmeds_df2 %>%
  kable(booktabs = T, caption = "Taking medications 2 population table", digits = 4) %>%
  kable_styling(bootstrap_options = c("striped", "hold_position"), full_width = F) #%>%
  #add_header_above(c(" ", "Training" = 2, "Training2"= 2, "Training3"= 2, " " =4)) %>%
  #add_footnote("footnote")
```


### Household Subsets

```{r}
subsethousehold_df1 <- reshape2::dcast(df_subsetall3, GZmehm1 ~ PAhhtype)

subsethousehold_df1$propWBSglnokidunder25 <- subsethousehold_df1[,2]/sum(subsethousehold_df1[,2])
subsethousehold_df1$propWBSglwithkidunder25 <- subsethousehold_df1[,2]/sum(subsethousehold_df1[,2])
subsethousehold_df1$propWBCplnokidunder25 <- subsethousehold_df1[,3]/sum(subsethousehold_df1[,3])
subsethousehold_df1$propWBCplwithkidunder25 <- subsethousehold_df1[,4]/sum(subsethousehold_df1[,4])
subsethousehold_df1$propWBCplwithkidandothers <- subsethousehold_df1[,5]/sum(subsethousehold_df1[,5])
subsethousehold_df1$propWBotherHHtype <- subsethousehold_df1[,6]/sum(subsethousehold_df1[,6]) 


subsethousehold_df1$propSglnokidunder25 <- subsethousehold_df1[,2]/(subsethousehold_df1[,7] + subsethousehold_df1[,2] +subsethousehold_df1[,3] +subsethousehold_df1[,4] + subsethousehold_df1[,5] + subsethousehold_df1[,6])
subsethousehold_df1$propSglwithkidunder25 <- subsethousehold_df1[,2]/(subsethousehold_df1[,7] + subsethousehold_df1[,2] +subsethousehold_df1[,3] +subsethousehold_df1[,4] + subsethousehold_df1[,5] + subsethousehold_df1[,6])
subsethousehold_df1$propCplnokidunder25 <- subsethousehold_df1[,3]/(subsethousehold_df1[,7] + subsethousehold_df1[,2] +subsethousehold_df1[,3] +subsethousehold_df1[,4] + subsethousehold_df1[,5] + subsethousehold_df1[,6])
subsethousehold_df1$propCplwithkidunder25 <- subsethousehold_df1[,4]/(subsethousehold_df1[,7] + subsethousehold_df1[,2] +subsethousehold_df1[,3] +subsethousehold_df1[,4] + subsethousehold_df1[,5] + subsethousehold_df1[,6])
subsethousehold_df1$propCplwithkidandothers <- subsethousehold_df1[,5]/(subsethousehold_df1[,7] + subsethousehold_df1[,2] +subsethousehold_df1[,3] +subsethousehold_df1[,4] + subsethousehold_df1[,5] + subsethousehold_df1[,6])
subsethousehold_df1$propotherHHtype <- subsethousehold_df1[,6]/(subsethousehold_df1[,7] + subsethousehold_df1[,2] +subsethousehold_df1[,3] +subsethousehold_df1[,4] + subsethousehold_df1[,5] + subsethousehold_df1[,6])


subsethousehold_df1 <- subsethousehold_df1 %>% rename(Sgl_No_Child = `10`, Sgl_W_Child = `21`, Cpl_No_Child = `22`, Cpl_W_Child =`23`, Cpl_ChildandOthers =`24`, Other_HHType =`25`)

subsethousehold_df1 %>%
  kable(booktabs = T, caption = "Household type population table", digits = 4) %>%
  kable_styling(bootstrap_options = c("striped", "hold_position")) %>%
  add_header_above(c(" ", "Population" = 6, "Population Proportion"= 6, "Proportion Well-being Cat" = 6)) #%>%
  #add_footnote("footnote")
#subsethousehold_df1$
```

### BMI Subsets

```{r}
#BMI Subsets  ( PAbmiB_k2 )
subsetBMI_df1 <- reshape2::dcast(df_subsetall3, GZmehm1 ~ PAbmiB_k2)

subsetBMI_df1$propWBUnderWeight <- subsetBMI_df1[,2]/sum(subsetBMI_df1[,2])
subsetBMI_df1$propWBNormalWeight <- subsetBMI_df1[,2]/sum(subsetBMI_df1[,2])
subsetBMI_df1$propWBOverweight <- subsetBMI_df1[,3]/sum(subsetBMI_df1[,3])
subsetBMI_df1$propWBObeseCat1 <- subsetBMI_df1[,4]/sum(subsetBMI_df1[,4])
subsetBMI_df1$propWBObeseCat2 <- subsetBMI_df1[,5]/sum(subsetBMI_df1[,5])
subsetBMI_df1$propWBObeseCat3 <- subsetBMI_df1[,6]/sum(subsetBMI_df1[,6]) 


subsetBMI_df1$propUnderWeight <- subsetBMI_df1[,2]/(subsetBMI_df1[,7] + subsetBMI_df1[,2] +subsetBMI_df1[,3] +subsetBMI_df1[,4] + subsetBMI_df1[,5] + subsetBMI_df1[,6])
subsetBMI_df1$propNormalWeight <- subsetBMI_df1[,2]/(subsetBMI_df1[,7] + subsetBMI_df1[,2] +subsetBMI_df1[,3] +subsetBMI_df1[,4] + subsetBMI_df1[,5] + subsetBMI_df1[,6])
subsetBMI_df1$propOverweight <- subsetBMI_df1[,3]/(subsetBMI_df1[,7] + subsetBMI_df1[,2] +subsetBMI_df1[,3] +subsetBMI_df1[,4] + subsetBMI_df1[,5] + subsetBMI_df1[,6])
subsetBMI_df1$propObeseCat1 <- subsetBMI_df1[,4]/(subsetBMI_df1[,7] + subsetBMI_df1[,2] +subsetBMI_df1[,3] +subsetBMI_df1[,4] + subsetBMI_df1[,5] + subsetBMI_df1[,6])
subsetBMI_df1$propObeseCat2 <- subsetBMI_df1[,5]/(subsetBMI_df1[,7] + subsetBMI_df1[,2] +subsetBMI_df1[,3] +subsetBMI_df1[,4] + subsetBMI_df1[,5] + subsetBMI_df1[,6])
subsetBMI_df1$propObeseCat3 <- subsetBMI_df1[,6]/(subsetBMI_df1[,7] + subsetBMI_df1[,2] +subsetBMI_df1[,3] +subsetBMI_df1[,4] + subsetBMI_df1[,5] + subsetBMI_df1[,6])


subsetBMI_df1 <- subsetBMI_df1 %>% rename(Underweight = `1`, NormalWeight = `2`, OverWeight = `3`, propObeseCatI =`4`, propObeseCatII =`5`, propObeseCatIII =`6`)

subsetBMI_df1 %>%
  kable(booktabs = T, caption = "BMI population table", digits = 4) %>%
  kable_styling(bootstrap_options = c("striped", "hold_position")) %>%
  add_header_above(c(" ", "Population" = 6, "Population Proportion"= 6, "Proportion Well-being Cat" = 6)) 
```


```{r}
#Viewing the significance of various aspects of PHYSICAL ACTIVITY, which are or are not significant
df_model_subsetPhysAct <- df_model_sumd %>% filter(str_detect(ThemeEn, "1501"))

df_model_subsetPhysAct %>%
  kable(booktabs = T, caption = "Physical activity significance table", digits = 4) %>%
  kable_styling(bootstrap_options = c("striped", "hold_position")) %>%
  add_header_above(c(" ", "Population" = 6, "Population Proportion"= 6, "Proportion Well-being Cat" = 6)) #%>%
  #add_footnote("footnote")
#subsethousehold_df1$
```

```{r}
#Viewing the significance of various aspects of PROTECTION FACTORS SUCH AS THE NUMBER OF PEOPLE THEY HAVE TO HELP THEM AND HOW EASY IT IS TO GET HELP, which are or are not significant
df_model_subsetProtFac <- df_model_sumd %>% filter(str_detect(ThemeEn, "1303"))
df_model_subsetProtFac %>%
  kable(booktabs = T, caption = "Protection factors significance table", digits = 4) %>%
  kable_styling(bootstrap_options = c("striped", "hold_position")) %>%
  add_header_above(c(" ", "Population" = 6, "Population Proportion"= 6, "Proportion Well-being Cat" = 6)) #%>%
  #add_footnote("footnote")
#subsethousehold_df1$
```




```{r}
#Viewing the significance of various aspects of SIGHT AND HEARING, which are or are not significant
df_model_subsetSeeandHear <- df_model_sumd %>% filter(str_detect(ThemeEn, "1104"))
df_model_subsetSeeandHear %>%
  kable(booktabs = T, caption = "Sight & hearing significance table", digits = 4) %>%
  kable_styling(bootstrap_options = c("striped", "hold_position")) %>%
  add_header_above(c(" ", "Population" = 6, "Population Proportion"= 6, "Proportion Well-being Cat" = 6)) #%>%
  #add_footnote("footnote")
#subsethousehold_df1$
```


```{r}
#Viewing the significance of various aspects of SOCIODEMOGRAPHICS, which are or are not significant
df_model_subsetSociodem <- df_model_sumd %>% filter(str_detect(ThemeEn, "1704"))
df_model_subsetSociodem %>%
  kable(booktabs = T, caption = "Sociodemographics", digits = 4) %>%
  kable_styling(bootstrap_options = c("striped", "hold_position")) %>%
  add_header_above(c(" ", "Population" = 4, "Population Proportion"= 4, "Proportion Well-being Cat" = 4)) #%>%
  #add_footnote("footnote")
```

### Income Subsets

```{r}

subsetincome_df1 <- reshape2::dcast(df_subsetall3, GZmehm1 ~ SDaeqeink_k)
subsetincome_df1$WBLess500 <- subsetincome_df1[,2]/sum(subsetincome_df1[,2])
subsetincome_df1$WB500to1000 <- subsetincome_df1[,3]/sum(subsetincome_df1[,3])
subsetincome_df1$WB1000to1500 <- subsetincome_df1[,4]/sum(subsetincome_df1[,4])
subsetincome_df1$WB1500to2000 <- subsetincome_df1[,5]/sum(subsetincome_df1[,5])
subsetincome_df1$WB2000to2500 <- subsetincome_df1[,6]/sum(subsetincome_df1[,6])
subsetincome_df1$WB2500to3000 <- subsetincome_df1[,7]/sum(subsetincome_df1[,7])
subsetincome_df1$WB3000to3500 <- subsetincome_df1[,8]/sum(subsetincome_df1[,8])
subsetincome_df1$WB3500to4000 <-  subsetincome_df1[,9]/sum(subsetincome_df1[,9])
subsetincome_df1$WB4000to4500 <- subsetincome_df1[,10]/sum(subsetincome_df1[,10])
subsetincome_df1$WB4500to5000 <- subsetincome_df1[,11]/sum(subsetincome_df1[,11])
subsetincome_df1$WBMore5000 <- subsetincome_df1[,12]/sum(subsetincome_df1[,12])

subsetincome_df1$Less500 <- subsetincome_df1[,2]/(subsetincome_df1[,2] + subsetincome_df1[,3] + subsetincome_df1[,4] + subsetincome_df1[,5] + subsetincome_df1[,6] + subsetincome_df1[,7] + subsetincome_df1[,8] + subsetincome_df1[,9] + subsetincome_df1[,10] + subsetincome_df1[,11] + subsetincome_df1[,12])
subsetincome_df1$E500to1000 <- subsetincome_df1[,3]/(subsetincome_df1[,2] + subsetincome_df1[,3] + subsetincome_df1[,4] + subsetincome_df1[,5] + subsetincome_df1[,6] + subsetincome_df1[,7] + subsetincome_df1[,8] + subsetincome_df1[,9] + subsetincome_df1[,10] + subsetincome_df1[,11] + subsetincome_df1[,12])
subsetincome_df1$E1000to1500 <- subsetincome_df1[,4]/(subsetincome_df1[,2] + subsetincome_df1[,3] + subsetincome_df1[,4] + subsetincome_df1[,5] + subsetincome_df1[,6] + subsetincome_df1[,7] + subsetincome_df1[,8] + subsetincome_df1[,9] + subsetincome_df1[,10] + subsetincome_df1[,11] + subsetincome_df1[,12])
subsetincome_df1$E1500to2000 <- subsetincome_df1[,5]/(subsetincome_df1[,2] + subsetincome_df1[,3] + subsetincome_df1[,4] + subsetincome_df1[,5] + subsetincome_df1[,6] + subsetincome_df1[,7] + subsetincome_df1[,8] + subsetincome_df1[,9] + subsetincome_df1[,10] + subsetincome_df1[,11] + subsetincome_df1[,12])
subsetincome_df1$E2000to2500 <- subsetincome_df1[,6]/(subsetincome_df1[,2] + subsetincome_df1[,3] + subsetincome_df1[,4] + subsetincome_df1[,5] + subsetincome_df1[,6] + subsetincome_df1[,7] + subsetincome_df1[,8] + subsetincome_df1[,9] + subsetincome_df1[,10] + subsetincome_df1[,11] + subsetincome_df1[,12])
subsetincome_df1$E2500to3000 <- subsetincome_df1[,7]/(subsetincome_df1[,2] + subsetincome_df1[,3] + subsetincome_df1[,4] + subsetincome_df1[,5] + subsetincome_df1[,6] + subsetincome_df1[,7] + subsetincome_df1[,8] + subsetincome_df1[,9] + subsetincome_df1[,10] + subsetincome_df1[,11] + subsetincome_df1[,12])
subsetincome_df1$E3000to3500 <- subsetincome_df1[,8]/(subsetincome_df1[,2] + subsetincome_df1[,3] + subsetincome_df1[,4] + subsetincome_df1[,5] + subsetincome_df1[,6] + subsetincome_df1[,7] + subsetincome_df1[,8] + subsetincome_df1[,9] + subsetincome_df1[,10] + subsetincome_df1[,11] + subsetincome_df1[,12])
subsetincome_df1$E3500to4000 <- subsetincome_df1[,9]/(subsetincome_df1[,2] + subsetincome_df1[,3] + subsetincome_df1[,4] + subsetincome_df1[,5] + subsetincome_df1[,6] + subsetincome_df1[,7] + subsetincome_df1[,8] + subsetincome_df1[,9] + subsetincome_df1[,10] + subsetincome_df1[,11] + subsetincome_df1[,12])
subsetincome_df1$E4000to4500 <- subsetincome_df1[,10]/(subsetincome_df1[,2] + subsetincome_df1[,3] + subsetincome_df1[,4] + subsetincome_df1[,5] + subsetincome_df1[,6] + subsetincome_df1[,7] + subsetincome_df1[,8] + subsetincome_df1[,9] + subsetincome_df1[,10] + subsetincome_df1[,11] + subsetincome_df1[,12])
subsetincome_df1$E4500to5000 <- subsetincome_df1[,11]/(subsetincome_df1[,2] + subsetincome_df1[,3] + subsetincome_df1[,4] + subsetincome_df1[,5] + subsetincome_df1[,6] + subsetincome_df1[,7] + subsetincome_df1[,8] + subsetincome_df1[,9] + subsetincome_df1[,10] + subsetincome_df1[,11] + subsetincome_df1[,12])
subsetincome_df1$EMore5000 <- subsetincome_df1[,12]/(subsetincome_df1[,2] + subsetincome_df1[,3] + subsetincome_df1[,4] + subsetincome_df1[,5] + subsetincome_df1[,6] + subsetincome_df1[,7] + subsetincome_df1[,8] + subsetincome_df1[,9] + subsetincome_df1[,10] + subsetincome_df1[,11] + subsetincome_df1[,12])

subsetincome_df1 <- subsetincome_df1 %>% rename(ELess_500 = `1`, E_500to1000 = `2`, E_1000to1500 = `3`, E_1500to2000 = `4`, E_2000to2500 = `5`, E_2500to3000 = `6`, E_3000to3500 = `7`, E_3500to4000 = `8`, E_4000to4500 =`9`, E_4500to5000 =`10`, E_More_5000 =`11`)
#subsetemployment_df1 <- subsetemployment_df1 %>% rename(employed = `1`, Unemployed = `2`, Student = `3`, Retired = `4`, Unabletoacquire = `5`, MilCivService = `6`, House = `7`, Inactive = `8`)


subsetincome_df1 %>%
  kable(booktabs = T, caption = "Income population table", digits = 4) %>%
  kable_styling(bootstrap_options = c("striped", "hold_position"), full_width = F) %>%
  add_header_above(c(" ", "Population" = 11, "Population Proportion"= 11, "Proportion Well-being Cat" = 11)) #%>%
  #add_footnote("footnote")
#subsetincome_df1
```


```{r}
#Viewing the significance of various aspects of FEDERAL STATE THEY LIVE IN, which are or are not significant
df_model_subsetStrain <- df_model_sumd %>% filter(str_detect(ThemeEn, "1801"))
df_model_subsetStrain %>% 
  kable() %>%
  kable_styling()
```



### Blood Pressure Subsets

```{r}
#Blood Pressure subsets ever diagnosed high
df_subset_HighBPever <- filter(df_subsetall3, KHhyp == "1")
df_subset_HighBPever <- df_subset_HighBPever %>% dplyr::select(-KHhyp)

#Blood Pressure subsets diagnosed high blood pressure in last 12 months
df_subset_HighBP12months <- filter(df_subsetall3, KHhyp12 == "1")
df_subset_HighBP12months <- df_subset_HighBP12months %>% dplyr::select(-KHhyp12)

#Currently taking medication for high blood pressure
#df_subset_BPTest12months <- filter(df_subsetall3, KHhyp12pB == "1")
#df_subset_BPTest12months <- df_subset_HighBP12months %>% dplyr::select(-KHhyp12pB)

#High Blood Pressure no medication
df_subset_HighBPnoMed <- df_subsetall3
df_subset_HighBPnoMed$HighBPwithoutmeds <- ifelse(df_subset_HighBPnoMed$KHhyp == 1 & df_subset_HighBPnoMed$KHhypmedC == 2, 1, 2)
#df_subset_HighBPnoMed <- filter(df_subset_HighBPnoMed, HighBPwithoutmeds == "1")
#df_subset_HighBPnoMed <- df_subset_HighBPnoMed %>% dplyr::select(-HighBPwithoutmeds)

```

```{r}
subsetBloodPressEver_df1 <- reshape2::dcast(df_subsetall3, GZmehm1 ~ KHhyp)
subsetBloodPressEver_df1$propYes <- subsetBloodPressEver_df1[,2]/sum(subsetBloodPressEver_df1[,2])
subsetBloodPressEver_df1$propNo <- subsetBloodPressEver_df1[,3]/sum(subsetBloodPressEver_df1[,3])


subsetBloodPress12Months_df1 <- reshape2::dcast(df_subsetall3, GZmehm1 ~ KHhyp12)
subsetBloodPress12Months_df1$propYes <- subsetBloodPress12Months_df1[,2]/sum(subsetBloodPress12Months_df1[,2])
subsetBloodPress12Months_df1$propNo <- subsetBloodPress12Months_df1[,3]/sum(subsetBloodPress12Months_df1[,3])


#subset_BPTest12months_df1 <- reshape2::dcast(df_subsetall3, GZmehm1 ~ KHhyp12pB)
#subset_BPTest12months_df1$propYes <- #subset_BPTest12months_df1[,2]/sum(df_subset_BPTest12months_df1[,2])
#subset_BPTest12months_df1$propNo <- subset_BPTest12months_df1[,3]/sum(df_subset_BPTest12months_df1[,3])


subset_HighBPnoMed <- reshape2::dcast(df_subset_HighBPnoMed, GZmehm1 ~ HighBPwithoutmeds)
subset_HighBPnoMed$propYes <- subset_HighBPnoMed[,2]/sum(subset_HighBPnoMed[,2])
subset_HighBPnoMed$propNo <- subset_HighBPnoMed[,3]/sum(subset_HighBPnoMed[,3])
```

##Vaccinations
```{r}
#Viewing the significance of various aspects of VACCINATIONS, which are or are not significant
df_model_subsetVaccinations <- df_model_sumd %>% filter(str_detect(ThemeEn, "1402"))
df_model_subsetVaccinations %>% 
  kable() %>%
  kable_styling()
```
































```{r}
#create training/test date
#df_HighBP12months_base <- df_subset_HighBP12months 

#HighBP12monthstrainingRows <- sample(1:nrow(df_HighBP12months_base), 0.8 * nrow(df_HighBP12months_base))
#HighBP12monthstrainingData <- df_subset_HighBP12months[HighBP12monthstrainingRows, ]
#HighBP12monthstestData <- df_subset_HighBP12months[-HighBP12monthstrainingRows, ]

#run ordinal logistic regression
#m_HighBP12months <- polr(GZmehm1 ~ ., data = df_HighBP12months_base, Hess=TRUE)


#df_model_HighBP12months <- as.data.frame(coef(summary(m_HighBP12months)))

## calculate and store p values
#df_model_HighBP12months$p <- pnorm(abs(df_model_HighBP12months$`t value`), lower.tail = FALSE) * 2

#df_model_HighBP12months$sig_col <- ifelse(df_model_HighBP12months$p < 0.001,'***',ifelse(df_model_HighBP12months$p < 0.01,'**',
 #                    ifelse(df_model_HighBP12months$p < 0.05,'*',
  #                          ifelse(df_model_HighBP12months$p < 0.1,'.', ''
                     ))))


#df_model_HighBP12months$logodds <- format(exp(df_model_HighBP12months$Value), trim = TRUE, digits = 3, scientific = F)

#df_meta_lvls$coeff_label <- paste0(df_meta_lvls$Varname,df_meta_lvls$numLevel)
#df_model_HighBP12months <- setDT(df_model_HighBP12months, keep.rownames = TRUE)[]
#df_model_HighBP12months <- df_model_HighBP12months %>% dplyr::rename(coeff_label = rn)
#df_model_HighBP12months <- df_model_HighBP12months %>% left_join((df_meta_lvls %>% dplyr::select(c(coeff_label, ThemeEn, Varname, VarLabelEn, textLabelEn))), by="coeff_label")

#df_model_HighBP12months %>% 
#  kable() %>%
#  kable_styling()
```


```{r}
#create training/test date
#df_HighBPever_base <- df_subset_HighBPever 

#HighBPevertrainingRows <- sample(1:nrow(df_HighBPever_base), 0.8 * nrow(df_HighBPever_base))
#HighBPevertrainingData <- df_subset_HighBPever[HighBPevertrainingRows, ]
#HighBPevertestData <- df_subset_HighBPever[-HighBPevertrainingRows, ]

#run ordinal logistic regression
#m_HighBPever <- polr(GZmehm1 ~ ., data = df_HighBPever_base, Hess=TRUE)


#df_model_HighBPever <- as.data.frame(coef(summary(m_HighBPever)))

## calculate and store p values
#df_model_HighBPever$p <- pnorm(abs(df_model_HighBPever$`t value`), lower.tail = FALSE) * 2

#df_model_HighBPever$sig_col <- ifelse(df_model_HighBPever$p < 0.001,'***',ifelse(df_model_HighBPever$p < 0.01,'**',
#                     ifelse(df_model_HighBPever$p < 0.05,'*',
#                            ifelse(df_model_HighBPever$p < 0.1,'.', ''
#                     ))))


#df_model_HighBPever$logodds <- format(exp(df_model_HighBPever$Value), trim = TRUE, digits = 3, scientific = F)

#df_meta_lvls$coeff_label <- paste0(df_meta_lvls$Varname,df_meta_lvls$numLevel)
#df_model_HighBPever <- setDT(df_model_HighBPever, keep.rownames = TRUE)[]
#df_model_HighBPever <- df_model_HighBPever %>% dplyr::rename(coeff_label = rn)
#df_model_HighBPever <- df_model_HighBPever %>% left_join((df_meta_lvls %>% dplyr::select(c(coeff_label, ThemeEn, Varname, VarLabelEn, textLabelEn))), by="coeff_label")

#df_model_HighBPever %>% 
#  kable() %>%
#  kable_styling()
```

```{r}
#smokes subset
#df_subset_SmokeDaily <- filter(df_subsetall3, RCstat == "1")
#df_subset_SmokeOccasionally <- filter(df_subsetall3, RCstat == "2")
#df_subset_SmokeQuit <- filter(df_subsetall3, RCstat == "3")
#df_subset_SmokeNever <- filter(df_subsetall3, RCstat == "4")

#df_subset_Smokes <- dplyr::bind_rows(df_subset_SmokeDaily, df_subset_SmokeOccasionally)

```



```{r}
#create training/test date
#df_Smokes_base <- df_subset_Smokes 

#SmokestrainingRows <- sample(1:nrow(df_Smokes_base), 0.8 * nrow(df_Smokes_base))
#SmokestrainingData <- df_subset_Smokes[SmokestrainingRows, ]
#SmokestestData <- df_subset_Smokes[-SmokestrainingRows, ]

#run ordinal logistic regression
#m_Smokes <- polr(GZmehm1 ~ ., data = df_Smokes_base, Hess=TRUE)


#df_model_Smokes <- as.data.frame(coef(summary(m_Smokes)))

## calculate and store p values
#df_model_Smokes$p <- pnorm(abs(df_model_Smokes$`t value`), lower.tail = FALSE) * 2

#df_model_Smokes$sig_col <- ifelse(df_model_Smokes$p < 0.001,'***',ifelse(df_model_Smokes$p < 0.01,'**',
#                     ifelse(df_model_Smokes$p < 0.05,'*',
#                            ifelse(df_model_Smokes$p < 0.1,'.', ''
                     ))))


#df_model_Smokes$logodds <- format(exp(df_model_Smokes$Value), trim = TRUE, digits = 3, scientific = F)

#df_meta_lvls$coeff_label <- paste0(df_meta_lvls$Varname,df_meta_lvls$numLevel)
#df_model_Smokes <- setDT(df_model_Smokes, keep.rownames = TRUE)[]
#df_model_Smokes <- df_model_Smokes %>% dplyr::rename(coeff_label = rn)
#df_model_Smokes <- df_model_Smokes %>% left_join((df_meta_lvls %>% dplyr::select(c(coeff_label, ThemeEn, Varname, VarLabelEn, textLabelEn))), by="coeff_label")

#df_model_Smokes %>% 
#  kable() %>%
#  kable_styling()
```


```{r}
#trainingData_HighBPever <- subset(trainingData,trainingData$KHhyp == 1)

#m_HighBPever <- polr(GZmehm1 ~ ., data = trainingData_HighBPever, Hess=TRUE)
#summary(m_HighBPever)

#df_model_HighBPever <- as.data.frame(coef(summary(m_HighBPever)))

## calculate and store p values
#df_model_HighBPever$p <- pnorm(abs(df_model_HighBPever$`t value`), lower.tail = FALSE) * 2

#df_model_HighBPever$sig_col <- ifelse(df_model_HighBPever$p < 0.001,'***',ifelse(df_model_HighBPever$p < 0.01,'**',
#                     ifelse(df_model_HighBPever$p < 0.05,'*',
#                            ifelse(df_model_HighBPever$p < 0.1,'.', ''
                     ))))


#df_model_HighBPever$logodds <- format(exp(df_model_HighBPever$Value), trim = TRUE, digits = 3, scientific = F)

#df_meta_lvls$coeff_label <- paste0(df_meta_lvls$Varname,df_meta_lvls$numLevel)
#df_model_HighBPever <- setDT(df_model_HighBPever, keep.rownames = TRUE)[]
#df_model_HighBPever <- df_model_HighBPever %>% dplyr::rename(coeff_label = rn)
#df_model_HighBPever <- df_model_HighBPever %>% left_join((df_meta_lvls %>% dplyr::select(c(coeff_label, ThemeEn, Varname, VarLabelEn, textLabelEn))), by="coeff_label")

#df_model_HighBPever %>% 
#  kable() %>%
#  kable_styling()
```


```{r}
#trainingData_smokeDaily2 <- subset(trainingData,trainingData$RCstat == 1)
#m_Daily2 <- polr(GZmehm1 ~ ., data =trainingData_smokeDaily2, Hess=TRUE)
#summary(m_smokeDaily2)

#df_model_sum <- as.data.frame(coef(summary(m_smokeDaily2)))

## calculate and store p values
#df_model_sum$p <- pnorm(abs(df_model_sum$`t value`), lower.tail = FALSE) * 2

#df_model_sum$sig_col <- ifelse(df_model_sum$p < 0.001,'***',ifelse(df_model_sum$p < 0.01,'**',
#                     ifelse(df_model_sum$p < 0.05,'*',
#                            ifelse(df_model_sum$p < 0.1,'.', ''
                     ))))


#df_model_sum$logodds <- format(exp(df_model_sum$Value), trim = TRUE, digits = 3, scientific = F)

#df_meta_lvls$coeff_label <- paste0(df_meta_lvls$Varname,df_meta_lvls$numLevel)
#df_model_sum <- setDT(df_model_sum, keep.rownames = TRUE)[]
#df_model_sum <- df_model_sum %>% dplyr::rename(coeff_label = rn)
#df_model_sum <- df_model_sum %>% left_join((df_meta_lvls %>% dplyr::select(c(coeff_label, ThemeEn, Varname, VarLabelEn, textLabelEn))), by="coeff_label")

#df_model_sum %>% 
#  kable() %>%
#  kable_styling()
```


```{r}
#flattenCorrMatrix <- function(cormat, pmat) {
#  ut <- upper.tri(cormat)
#  data.frame(
#    row = rownames(cormat)[row(cormat)[ut]],
#    column = rownames(cormat)[col(cormat)[ut]],
#    cor  =(cormat)[ut],
#    p = pmat[ut]
#    )
#}
```

```{r}

#corr.df_subset_SmokeDaily2<-rcorr(as.matrix(df_subset_SmokeDaily2))
#flattenCorrMatrix(corr.df_subset_SmokeDaily2$r, corr.df_subset_SmokeDaily2$P)
```


```{r}
#corr.df_subset_SmokeDaily <- cor(df_subset_SmokeDaily2)
#corrplot(corr.df_subset_SmokeDaily, type = "upper", order = "hclust", 
#         tl.col = "black", tl.srt = 45)


```


```{r}
#corr.df_subset_SmokeDaily <- cor( df_subset_SmokeDaily2 )
#corr.df_subset_SmokeDaily[ lower.tri( df_subset_SmokeDaily2, diag = TRUE ) ] <- NA
#corrplot(df_subset_SmokeDaily2, type = "upper", diag = FALSE )
```

```{r}

#msmokedaily <- melt( corr.df_subset_SmokeDaily )
#msmokedaily <- msmokedaily[order(- abs(msmokedaily$value)), ]
# get rid of NAs
#msmokedaily <- na.omit(msmokedaily)
# view the highest correlated: rho > 0.5
#(msmokedaily[ which( msmokedaily$value > 0.5 ), ])
```


```{r}
#df_SmokeDaily_base <- df_subset_SmokeDaily 

#SmokeDailytrainingRows <- sample(1:nrow(df_SmokeDaily_base), 0.8 * nrow(df_SmokeDaily_base))
#SmokeDailytrainingData <- df_subset_SmokeDaily[SmokeDailytrainingRows, ]
#SmokeDailytestData <- df_subset_SmokeDaily[-SmokeDailytrainingRows, ]


#m_SmokeDaily <- polr(GZmehm1 ~ ., data = df_SmokeDaily_base, Hess=FALSE)


#df_model_SmokeDaily <- as.data.frame(coef(summary(m_SmokeDaily)))

## calculate and store p values
#df_model_SmokeDaily$p <- pnorm(abs(df_model_SmokeDaily$`t value`), lower.tail = FALSE) * 2

#df_model_SmokeDaily$sig_col <- ifelse(df_model_SmokeDaily$p < 0.001,'***',ifelse(df_model_SmokeDaily$p < 0.01,'**',
#                     ifelse(df_model_SmokeDaily$p < 0.05,'*',
#                            ifelse(df_model_SmokeDaily$p < 0.1,'.', ''
                     ))))


#df_model_SmokeDaily$logodds <- format(exp(df_model_SmokeDaily$Value), trim = TRUE, digits = 3, scientific = F)

#df_meta_lvls$coeff_label <- paste0(df_meta_lvls$Varname,df_meta_lvls$numLevel)
#df_model_SmokeDaily <- setDT(df_model_SmokeDaily, keep.rownames = TRUE)[]
#df_model_SmokeDaily <- df_model_SmokeDaily %>% dplyr::rename(coeff_label = rn)
#df_model_SmokeDaily <- df_model_SmokeDaily %>% left_join((df_meta_lvls %>% dplyr::select(c(coeff_label, ThemeEn, Varname, VarLabelEn, textLabelEn))), by="coeff_label")

#df_model_SmokeDaily %>% 
#  kable() %>%
#  kable_styling()
```


```{r}
#df_SmokeOccasionally_base <- df_subset_SmokeOccasionally 

#SmokeOccasionallytrainingRows <- sample(1:nrow(df_SmokeOccasionally_base), 0.8 * nrow(df_SmokeOccasionally_base))
#SmokeOccasionallytrainingData <- df_subset_SmokeOccasionally[SmokeOccasionallytrainingRows, ]
#SmokeOccasionallytestData <- df_subset_SmokeOccasionally[-SmokeOccasionallytrainingRows, ]


#m_SmokeOccasionally <- polr(GZmehm1 ~ ., data = df_SmokeOccasionally_base, Hess=FALSE)


#df_model_SmokeOccasionally <- as.data.frame(coef(summary(m_SmokeOccasionally)))

## calculate and store p values
#df_model_SmokeOccasionally$p <- pnorm(abs(df_model_SmokeOccasionally$`t value`), lower.tail = FALSE) * 2

#df_model_SmokeOccasionally$sig_col <- ifelse(df_model_SmokeOccasionally$p < 0.001,'***',ifelse(df_model_SmokeOccasionally$p < 0.01,'**',
#                     ifelse(df_model_SmokeOccasionally$p < 0.05,'*',
#                            ifelse(df_model_SmokeOccasionally$p < 0.1,'.', ''
                     ))))


#df_model_SmokeOccasionally$logodds <- format(exp(df_model_SmokeOccasionally$Value), trim = TRUE, digits = 3, scientific = F)

#df_meta_lvls$coeff_label <- paste0(df_meta_lvls$Varname,df_meta_lvls$numLevel)
#df_model_SmokeOccasionally <- setDT(df_model_SmokeOccasionally, keep.rownames = TRUE)[]
#df_model_SmokeOccasionally <- df_model_SmokeOccasionally %>% dplyr::rename(coeff_label = rn)
#df_model_SmokeOccasionally <- df_model_SmokeOccasionally %>% left_join((df_meta_lvls %>% dplyr::select(c(coeff_label, ThemeEn, Varname, VarLabelEn, textLabelEn))), by="coeff_label")

#df_model_SmokeOccasionally %>% 
#  kable() %>%
#  kable_styling()
```


```{r}
#df_SmokeNoMore_base <- df_subset_SmokeNoMore 

#SmokeNoMoretrainingRows <- sample(1:nrow(df_SmokeNoMore_base), 0.8 * nrow(df_SmokeNoMore_base))
#SmokeNoMoretrainingData <- df_subset_SmokeNoMore[SmokeNoMoretrainingRows, ]
#SmokeNoMoretestData <- df_subset_SmokeNoMore[-SmokeNoMoretrainingRows, ]


#m_SmokeNoMore <- polr(GZmehm1 ~ ., data = df_SmokeNoMore_base, Hess=FALSE)


#df_model_SmokeNoMore <- as.data.frame(coef(summary(m_SmokeNoMore)))

## calculate and store p values
#df_model_SmokeNoMore$p <- pnorm(abs(df_model_SmokeNoMore$`t value`), lower.tail = FALSE) * 2

#df_model_SmokeNoMore$sig_col <- ifelse(df_model_SmokeNoMore$p < 0.001,'***',ifelse(df_model_SmokeNoMore$p < 0.01,'**',
#                     ifelse(df_model_SmokeNoMore$p < 0.05,'*',
#                            ifelse(df_model_SmokeNoMore$p < 0.1,'.', ''
                     ))))


#df_model_SmokeNoMore$logodds <- format(exp(df_model_SmokeNoMore$Value), trim = TRUE, digits = 3, scientific = F)

#df_meta_lvls$coeff_label <- paste0(df_meta_lvls$Varname,df_meta_lvls$numLevel)
#df_model_SmokeNoMore <- setDT(df_model_SmokeNoMore, keep.rownames = TRUE)[]
#df_model_SmokeNoMore <- df_model_SmokeNoMore %>% dplyr::rename(coeff_label = rn)
#df_model_SmokeNoMore <- df_model_SmokeNoMore %>% left_join((df_meta_lvls %>% dplyr::select(c(coeff_label, ThemeEn, Varname, VarLabelEn, textLabelEn))), by="coeff_label")

#df_model_SmokeNoMore %>% 
#  kable() %>%
#  kable_styling()
```



```{r}
#df_subset_Wellbeing1 <- filter(df_subsetall3, GZmehm1 == "1")
#df_subset_Wellbeing2 <- filter(df_subsetall3, GZmehm1 == "2")
#df_subset_Wellbeing3 <- filter(df_subsetall3, GZmehm1 == "3")
#df_subset_Wellbeing4 <- filter(df_subsetall3, GZmehm1 == "4")
#df_subset_Wellbeing5 <- filter(df_subsetall3, GZmehm1 == "5")
```


```{r}
#describe(as.numeric(df_subset_Wellbeing1$RCstat))
#describe(df_subset_Wellbeing2$RCstat)
#describe(df_subset_Wellbeing3$RCstat)
#describe(df_subset_Wellbeing4$RCstat)
#describe(df_subset_Wellbeing5$RCstat)
```






