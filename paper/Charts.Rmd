---
title: "PaperCharts"
author: "Uli Kaulfuss"
date: "15 4 2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

set.seed(42)

library(foreign)
# library(readstata13)
library(dplyr)
library(naniar)
library(glmnet)
library(ggplot2)
library(gridExtra)
library(MASS)
library(Hmisc)
library(reshape2)
library(cluster)
library(VIM)
library(readxl)
library(gdata)
library(caret)
library(nnet)
library(dummies)
library(car)
library(knitr)
library(kableExtra)
library(stargazer)
library(scales)
library(readr)

```

## Charts for the published paper

```{r, echo=F}
load(file = "../analysis/data/geda_data.RData")
hist(as.numeric(df_geda_num[!is.na(df_geda_num$GZmehm1),]$GZmehm1), breaks=.5:5.5, main="Histogram of the wellbeing score (response)", xlab="1=very bad | 5=very good")
```

```{r}

df_chart <- read_excel("data/Number_variables_per_category.xlsx")

ggplot(df_chart, aes(y=Value, x=Type)) + 
  geom_bar(position="stack", stat="identity") + coord_flip() +
  theme(axis.text.x = element_text(angle = 90))

```


```{r}
subTitle <- "" # "(1973-74)" 
title <- "Distribution of wellbeing scores within cleaned dataset"
caption<- "" # "(1973-74)" 
subTitle <- "" # "(1973-74)" 
xLab <- "Wellbeing-Score (GZMehm1)"
yLab <- "Count (#)"

ggplot(df_geda_num, aes(x=as.numeric(as.character(GZmehm1))))+
  geom_histogram(color="black", fill="lightblue", binwidth=.5, position="dodge") +
  labs(title = title,
       subtitle = subTitle,
       caption = caption,
       
       x = xLab,
       y = yLab,
       colour = "Gears")+
  scale_y_continuous(labels=comma) + 
  theme_bw()
```


```{r 2.7: Statistically Sig Variables}
var_sig <- read_csv("data/2.7_stat_sig_var.csv")

ggplot(var_sig, aes(fill=condition, y=value, x=theme)) + 
  geom_bar(position="stack", stat="identity")+
  theme(axis.text.x = element_text(angle = 90))
```

```{r Causal: PSM}

psm_df <- read_csv("data/causal_PSM_scores.csv")

labs <- paste("Visit general practitioner in LTM:", c("NO", "YES"))
psm_df %>%
  mutate(treated = ifelse(treated == 1, labs[1], labs[2])) %>%
  ggplot(aes(x = predict_score)) +
  geom_histogram(color = "white") +
  facet_wrap(~treated) +
  xlab("Propensity Score (Prob. of NOT having visited GP in LTM)") +
  theme_bw()
```

```{r}

mean_PSM_table <- read_csv("data/causal_mean_PSM_table.csv")
kable(mean_PSM_table) %>%
  add_header_above(c("Alias:","Last 12 Month: General Practitioner Visits","Gender (0:1)","Wellbeing Score (1:5)","Type of Smoker","German State of Residence","Household Type"))

```


```{r}
df_chart <- read_csv("data/distribution_marginal_effects.csv")

p_worsen <-  ggplot(df_chart, aes(x=score_worsen)) + 
  geom_histogram(color="black", fill="white") + labs(title="Impact towards being worse off")

p_neutral <-  ggplot(df_chart, aes(x=score_ensuring)) + 
  geom_histogram(color="black", fill="white") + labs(title="Impact towards staying in the same category")

p_improve <- ggplot(df_chart, aes(x=score_improve)) + 
  geom_histogram(color="black", fill="white") + labs(title="Impact towards improving")

grid.arrange(grobs = list(p_worsen, p_neutral, p_improve), ncol=3,top="")
```



```{r}
df_chart <- read_csv("data/Impact_of_incremental_improvement.csv")
p <- ggplot(df_chart, aes(x=`_changed`, y=mean)) + 
  geom_bar(stat="identity", color="black", 
           position=position_dodge()) +
  geom_errorbar(aes(ymin=mean-std, ymax=mean+std), width=.2,
                 position=position_dodge(.9))  + coord_flip()
p

```

```{r}
df_chart <- read_csv("data/Impact_of_simulating_incremental_change_worsen.csv")
p <- ggplot(df_chart, aes(x=`_changed`, y=mean)) + 
  geom_bar(stat="identity", color="black", 
           position=position_dodge()) +
  geom_errorbar(aes(ymin=mean-std, ymax=mean+std), width=.2,
                 position=position_dodge(.9))  + coord_flip()
p

```

```{r}
#Life Expectancy Chart
df_geda_LifeExp2 <- read_csv("data/Figure_12_LifeExpectancy_to_Well-Being_Score.csv")

ggplot(df_geda_LifeExp2, aes(LifeExp, as.numeric(GZmehm1)*as.numeric(age5B)*as.numeric(sex)* as.numeric(bula)) ) +
  geom_point() +
  stat_smooth(method = "lm", formula = y ~ x)

```



```{r}
@TODO: box-plot from python

df_chart_mae <- read_excel("data/model_performance_comparison.xlsx", sheet="MAE")

p <- ggplot(df_chart_mae, aes(Model, hwy))
p + geom_boxplot()

summarydata<-list(stats=matrix(c(1,2,3,4,5),5,1), n=10)
bxp(summarydata)

```


```{r}
@TODO: confusion matrix from python

df_chart_ord <- read_csv("data/df_cm_rf.csv")
df_chart_rf <- read_csv("data/df_cm_ord.csv")


```
