---
title: "PaperCharts"
author: "Uli Kaulfuss"
date: "15 4 2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

set.seed(42)

library(foreign)
# library(readstata13)
library(dplyr)
library(naniar)
library(glmnet)
library(ggplot2)
library(MASS)
library(Hmisc)
library(reshape2)
library(cluster)
library(VIM)
library(readxl)
library(gdata)
library(caret)
library(nnet)
library(dummies)
library(car)
library(knitr)
library(kableExtra)
library(stargazer)
library(scales)
library(readr)

```

## Charts for the published paper

```{r, echo=F}
load(file = "../analysis/data/geda_data.RData")
hist(as.numeric(df_geda_num[!is.na(df_geda_num$GZmehm1),]$GZmehm1), breaks=.5:5.5, main="Histogram of the wellbeing score (response)", xlab="1=very bad | 5=very good")
```


```{r}
subTitle <- "" # "(1973-74)" 
title <- "Distribution of wellbeing scores within cleaned dataset"
caption<- "" # "(1973-74)" 
subTitle <- "" # "(1973-74)" 
xLab <- "Wellbeing-Score (GZMehm1)"
yLab <- "Count (#)"

ggplot(df_geda_num, aes(x=as.numeric(as.character(GZmehm1))))+
  geom_histogram(color="black", fill="lightblue", binwidth=.5, position="dodge") +
  labs(title = title,
       subtitle = subTitle,
       caption = caption,
       
       x = xLab,
       y = yLab,
       colour = "Gears")+
  scale_y_continuous(labels=comma) + 
  theme_bw()
```


```{r 2.7: Statistically Sig Variables}
var_sig <- read_csv("data/2.7_stat_sig_var.csv")

ggplot(var_sig, aes(fill=condition, y=value, x=theme)) + 
  geom_bar(position="stack", stat="identity")+
  theme(axis.text.x = element_text(angle = 90))
```

```{r Causal: PSM}

psm_df <- read_csv("data/causal_PSM_scores.csv")

labs <- paste("Visit general practitioner in LTM:", c("NO", "YES"))
psm_df %>%
  mutate(treated = ifelse(treated == 1, labs[1], labs[2])) %>%
  ggplot(aes(x = predict_score)) +
  geom_histogram(color = "white") +
  facet_wrap(~treated) +
  xlab("Propensity Score (Prob. of NOT having visited GP in LTM)") +
  theme_bw()
```

```{r}

mean_PSM_table <- read_csv("data/causal_mean_PSM_table.csv")
kable(mean_PSM_table) %>%
  add_header_above(c("Alias:","Last 12 Month: General Practitioner Visits","Gender (0:1)","Wellbeing Score (1:5)","Type of Smoker","German State of Residence","Household Type"))

```

